<!doctype html>







<html
  class="not-ready lg:text-base"
  style="--bg:#faf8f1"
  lang="zh-cn"
  dir="ltr"
><head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  
  <title> - è‡ªåŠ¨é©¾é©¶/æœºå™¨äººå­¦ä¹ ç¬”è®°</title>

  
  <meta name="theme-color" />

  <meta name="description" content="ðŸš€ Day 1ï¼šç«¯åˆ°ç«¯è‡ªåŠ¨é©¾é©¶æ¨¡åž‹ - UniAD
ðŸ“Œ ä»Šæ—¥å­¦ä¹ æ¨¡åž‹ï¼šUniADï¼ˆUnified Autonomous Drivingï¼‰
ä¸€å¥è¯æ¦‚æ‹¬ï¼šé¦–ä¸ªç«¯åˆ°ç«¯çš„è‡ªåŠ¨é©¾é©¶å…¨æ ˆæ¨¡åž‹ï¼Œç”¨ä¸€ä¸ªç»Ÿä¸€æ¨¡åž‹å¤„ç†æ„ŸçŸ¥ã€é¢„æµ‹ã€è§„åˆ’æ‰€æœ‰ä»»åŠ¡ã€‚

ðŸŽ¯ æ¨¡åž‹åŸºæœ¬ä¿¡æ¯

  
      
          é¡¹ç›®
          å†…å®¹
      
  
  
      
          æå‡ºæœºæž„
          ä¸Šæµ·äººå·¥æ™ºèƒ½å®žéªŒå®¤ã€é¦™æ¸¯å¤§å­¦ç­‰
      
      
          å‘è¡¨ä¼šè®®
          CVPR 2023 (Oral)
      
      
          æ ¸å¿ƒåˆ›æ–°
          é¦–ä¸ªç«¯åˆ°ç«¯å¯è®­ç»ƒçš„è‡ªåŠ¨é©¾é©¶å…¨æ ˆæ¨¡åž‹
      
      
          ä»£ç çŠ¶æ€
          å·²å¼€æº
      
      
          è®ºæ–‡åœ°å€
          https://arxiv.org/abs/2304.05841
      
      
          GitHub
          https://github.com/OpenDriveLab/UniAD
      
  


ðŸ” ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ
ä¼ ç»Ÿè‡ªåŠ¨é©¾é©¶æ–¹æ¡ˆçš„é—®é¢˜ï¼š
ä¼ ç»Ÿæµæ°´çº¿ï¼š
æ„ŸçŸ¥ â†’ é¢„æµ‹ â†’ è§„åˆ’ â†’ æŽ§åˆ¶
    â†“      â†“      â†“
æ¯ä¸ªæ¨¡å—ç‹¬ç«‹è®­ç»ƒã€è¯¯å·®ç´¯ç§¯ã€ä¿¡æ¯æŸå¤±
UniADçš„è§£å†³æ–¹æ¡ˆï¼š
ç«¯åˆ°ç«¯ï¼š
åŽŸå§‹ä¼ æ„Ÿå™¨è¾“å…¥ â†’ ç»Ÿä¸€æ¨¡åž‹ â†’ æŽ§åˆ¶ä¿¡å·
           â†“
   å…±äº«ç‰¹å¾ã€è”åˆä¼˜åŒ–

ðŸ—ï¸ æ¨¡åž‹æž¶æž„è¯¦è§£
æ•´ä½“æž¶æž„å›¾
         [å¤šç›¸æœºå›¾åƒ] / [ç‚¹äº‘]
                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æ„ŸçŸ¥éª¨å¹²ç½‘ç»œ   â”‚ â† BEVFormerç­‰
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ å¤šä»»åŠ¡Transformerâ”‚ â† æ ¸å¿ƒåˆ›æ–°ï¼
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“      â†“      â†“
      è½¨è¿¹é¢„æµ‹  å æ®é¢„æµ‹  è§„åˆ’
ä»£ç æ¡†æž¶æ¦‚è§ˆ
class UniAD(nn.Module):
    def __init__(self):
        super().__init__()
        # 1. ç‰¹å¾æå–
        self.backbone = BEVFormer()
        
        # 2. å¤šä»»åŠ¡è§£ç å™¨ï¼ˆæ ¸å¿ƒï¼‰
        self.perception_head = PerceptionHead()      # æ£€æµ‹/è·Ÿè¸ª
        self.map_head = MapHead()                    # åœ°å›¾ç†è§£
        self.occ_head = OccupancyHead()              # å æ®é¢„æµ‹
        self.motion_head = MotionHead()              # è½¨è¿¹é¢„æµ‹
        self.planning_head = PlanningHead()          # è·¯å¾„è§„åˆ’
        
    def forward(self, images, lidar=None):
        # æå–BEVç‰¹å¾
        bev_features = self.backbone(images)
        
        # å¤šä»»åŠ¡å¹¶è¡Œé¢„æµ‹
        outputs = {
            &#39;detection&#39;: self.perception_head(bev_features),
            &#39;map&#39;: self.map_head(bev_features),
            &#39;occupancy&#39;: self.occ_head(bev_features),
            &#39;motion&#39;: self.motion_head(bev_features),
            &#39;planning&#39;: self.planning_head(bev_features)
        }
        
        return outputs

ðŸ§© æ ¸å¿ƒç»„ä»¶è¯¦è§£
1. æ„ŸçŸ¥æ¨¡å—ï¼ˆPerceptionï¼‰
class PerceptionHead(nn.Module):
    &#34;&#34;&#34;æ£€æµ‹&#43;è·Ÿè¸ªï¼ŒåŸºäºŽQuery-basedè®¾è®¡&#34;&#34;&#34;
    def __init__(self, num_queries=100):
        super().__init__()
        # Queryåˆå§‹åŒ–
        self.query_embed = nn.Embedding(num_queries, hidden_dim)
        
        # Transformerè§£ç å™¨
        self.decoder = TransformerDecoder(
            num_layers=6,
            num_heads=8,
            dim_feedforward=2048
        )
        
    def forward(self, bev_features, queries):
        # ç”¨Queryä¸ŽBEVç‰¹å¾äº¤äº’
        outputs = self.decoder(queries, bev_features)
        
        # é¢„æµ‹3Dæ¡†ã€é€Ÿåº¦ã€ç±»åˆ«ç­‰
        bboxes = self.bbox_head(outputs)
        scores = self.score_head(outputs)
        
        return {&#39;boxes&#39;: bboxes, &#39;scores&#39;: scores}
2. é¢„æµ‹æ¨¡å—ï¼ˆPredictionï¼‰
class MotionHead(nn.Module):
    &#34;&#34;&#34;è½¨è¿¹é¢„æµ‹ï¼Œè€ƒè™‘å¤šæ™ºèƒ½ä½“äº¤äº’&#34;&#34;&#34;
    def __init__(self):
        super().__init__()
        # åœºæ™¯çº§äº¤äº’å»ºæ¨¡
        self.scene_encoder = SceneEncoder()
        
        # å¤šæ¨¡æ€è½¨è¿¹ç”Ÿæˆ
        self.trajectory_decoder = TrajectoryDecoder(
            num_modes=6,          # 6æ¡å¯èƒ½è½¨è¿¹
            horizon=12            # é¢„æµ‹æœªæ¥3ç§’ï¼ˆ12å¸§@4Hzï¼‰
        )
    
    def forward(self, bev_features, agent_queries):
        # ç¼–ç åœºæ™¯ä¸Šä¸‹æ–‡
        scene_context = self.scene_encoder(bev_features)
        
        # ä¸ºæ¯ä¸ªæ™ºèƒ½ä½“é¢„æµ‹å¤šæ¨¡æ€è½¨è¿¹
        trajectories = []
        confidences = []
        
        for agent_query in agent_queries:
            # è€ƒè™‘ä¸Žåœºæ™¯å’Œå…¶ä»–æ™ºèƒ½ä½“çš„äº¤äº’
            traj, conf = self.trajectory_decoder(
                agent_query, scene_context
            )
            trajectories.append(traj)
            confidences.append(conf)
        
        return {
            &#39;trajectories&#39;: trajectories,  # [B, N, M, T, 2]
            &#39;confidences&#39;: confidences     # [B, N, M]
        }
3. è§„åˆ’æ¨¡å—ï¼ˆPlanningï¼‰
class PlanningHead(nn.Module):
    &#34;&#34;&#34;ç«¯åˆ°ç«¯è·¯å¾„è§„åˆ’&#34;&#34;&#34;
    def __init__(self, planning_horizon=80):
        super().__init__()
        # è‡ªè½¦çŠ¶æ€ç¼–ç 
        self.ego_encoder = EgoStateEncoder()
        
        # åŸºäºŽtransformerçš„è§„åˆ’å™¨
        self.planner = TransformerPlanner(
            hidden_dim=256,
            num_layers=4,
            num_heads=8
        )
        
        # è½¨è¿¹è§£ç å™¨
        self.trajectory_decoder = MLP(
            input_dim=256,
            hidden_dims=[512, 256, 128],
            output_dim=planning_horizon * 2  # (x, y)åæ ‡
        )
    
    def forward(self, bev_features, ego_state, goals):
        &#34;&#34;&#34;
        ego_state: è‡ªè½¦çŠ¶æ€ [é€Ÿåº¦ã€èˆªå‘è§’ç­‰]
        goals: å¯èƒ½çš„ç»ˆç‚¹ [å¯é€‰]
        &#34;&#34;&#34;
        # ç¼–ç è‡ªè½¦çŠ¶æ€
        ego_embedding = self.ego_encoder(ego_state)
        
        # ä¸Žåœºæ™¯ç‰¹å¾èžåˆ
        planning_features = torch.cat([
            bev_features.mean(dim=[-2, -1]),  # å…¨å±€åœºæ™¯ç‰¹å¾
            ego_embedding
        ], dim=-1)
        
        # è§„åˆ’æŽ¨ç†
        plan_latent = self.planner(planning_features)
        
        # è§£ç ä¸ºè½¨è¿¹
        trajectory = self.trajectory_decoder(plan_latent)
        trajectory = trajectory.view(-1, self.planning_horizon, 2)  # [B, T, 2]
        
        return {
            &#39;trajectory&#39;: trajectory,
            &#39;cost_map&#39;: None,  # ç«¯åˆ°ç«¯ä¸æ˜¾å¼ç”Ÿæˆä»£ä»·åœ°å›¾
            &#39;feasibility&#39;: self.feasibility_head(plan_latent)
        }

ðŸ”„ è®­ç»ƒç­–ç•¥çš„åˆ›æ–°
å¤šä»»åŠ¡è”åˆè®­ç»ƒ
def multi_task_loss(predictions, ground_truth):
    &#34;&#34;&#34;ç»Ÿä¸€çš„å¤šä»»åŠ¡æŸå¤±å‡½æ•°&#34;&#34;&#34;
    losses = {}
    
    # 1. æ£€æµ‹æŸå¤±
    losses[&#39;det&#39;] = detection_loss(
        predictions[&#39;detection&#39;], 
        ground_truth[&#39;boxes&#39;]
    )
    
    # 2. è·Ÿè¸ªæŸå¤±
    losses[&#39;track&#39;] = tracking_loss(
        predictions[&#39;detection&#39;], 
        ground_truth[&#39;track_ids&#39;]
    )
    
    # 3. åœ°å›¾ç†è§£æŸå¤±
    losses[&#39;map&#39;] = map_loss(
        predictions[&#39;map&#39;], 
        ground_truth[&#39;hdmap&#39;]
    )
    
    # 4. å æ®é¢„æµ‹æŸå¤±
    losses[&#39;occ&#39;] = occupancy_loss(
        predictions[&#39;occupancy&#39;], 
        ground_truth[&#39;occupancy&#39;]
    )
    
    # 5. è¿åŠ¨é¢„æµ‹æŸå¤±
    losses[&#39;motion&#39;] = motion_loss(
        predictions[&#39;motion&#39;], 
        ground_truth[&#39;trajectories&#39;]
    )
    
    # 6. è§„åˆ’æŸå¤±ï¼ˆå…³é”®ï¼ï¼‰
    losses[&#39;plan&#39;] = planning_loss(
        predictions[&#39;planning&#39;], 
        ground_truth[&#39;ego_trajectory&#39;]
    )
    
    # åŠ æƒæ±‚å’Œ
    total_loss = (
        losses[&#39;det&#39;] * 1.0 &#43;
        losses[&#39;track&#39;] * 1.0 &#43;
        losses[&#39;map&#39;] * 0.5 &#43;
        losses[&#39;occ&#39;] * 0.5 &#43;
        losses[&#39;motion&#39;] * 2.0 &#43;
        losses[&#39;plan&#39;] * 5.0  # è§„åˆ’ä»»åŠ¡æƒé‡æœ€é«˜
    )
    
    return total_loss, losses
è¯¾ç¨‹å­¦ä¹ ç­–ç•¥
class CurriculumLearning:
    &#34;&#34;&#34;æ¸è¿›å¼è®­ç»ƒç­–ç•¥&#34;&#34;&#34;
    
    def schedule_training(self, epoch):
        if epoch &lt; 10:
            # é˜¶æ®µ1ï¼šåªè®­ç»ƒæ„ŸçŸ¥
            return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5}
        elif epoch &lt; 20:
            # é˜¶æ®µ2ï¼šåŠ å…¥é¢„æµ‹
            return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5, 
                    &#39;motion&#39;: 1.0}
        elif epoch &lt; 30:
            # é˜¶æ®µ3ï¼šåŠ å…¥è§„åˆ’
            return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5,
                    &#39;motion&#39;: 2.0, &#39;plan&#39;: 5.0}
        else:
            # é˜¶æ®µ4ï¼šå…¨ä»»åŠ¡è”åˆè®­ç»ƒ
            return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5,
                    &#39;occ&#39;: 0.5, &#39;motion&#39;: 2.0, &#39;plan&#39;: 5.0}

ðŸ“Š æ€§èƒ½è¡¨çŽ°
åœ¨nuScenesæ•°æ®é›†ä¸Šçš„ç»“æžœ
ä»»åŠ¡           | æŒ‡æ ‡          | UniAD  | ä¼ ç»ŸSOTA | æå‡
---------------|---------------|--------|----------|------
3Dæ£€æµ‹         | mAP           | 62.4   | 61.3     | &#43;1.1
è·Ÿè¸ª           | AMOTA         | 69.2   | 68.1     | &#43;1.1
è½¨è¿¹é¢„æµ‹       | minADEâ‚†       | 0.71   | 0.80     | -11.2%
å æ®é¢„æµ‹       | IoU           | 52.3   | 50.1     | &#43;2.2
è§„åˆ’           | L2è¯¯å·®(m)     | 0.78   | 0.89     | -12.4%
ç¢°æ’žçŽ‡         | â†“             | 0.15%  | 0.23%    | -34.8%
å…³é”®ä¼˜åŠ¿

è¯¯å·®å‡å°‘34%ï¼šç›¸æ¯”æ¨¡å—åŒ–æ–¹æ¡ˆ
å®žæ—¶æŽ¨ç†ï¼š120ms/å¸§ï¼ˆRTX 3090ï¼‰
æ³›åŒ–æ€§å¼ºï¼šåœ¨æœªè§è¿‡çš„åœºæ™¯è¡¨çŽ°è‰¯å¥½


ðŸ› ï¸ å¿«é€Ÿå¼€å§‹ï¼ˆ10åˆ†é’Ÿè·‘é€šDemoï¼‰
1. çŽ¯å¢ƒå®‰è£…
# å…‹éš†ä»£ç 
git clone https://github.com/OpenDriveLab/UniAD.git
cd UniAD

# åˆ›å»ºçŽ¯å¢ƒ
conda create -n uniad python=3.8
conda activate uniad

# å®‰è£…ä¾èµ–
pip install torch==1.11.0&#43;cu113 torchvision==0.12.0&#43;cu113 \
            torchaudio==0.11.0 --extra-index-url https://download.pytorch.org/whl/cu113
pip install mmcv-full==1.6.0 -f https://download.openmmlab.com/mmcv/dist/cu113/torch1.11.0/index.html
pip install -r requirements.txt

# å®‰è£…MMDetection3D
pip install mmdet==2.28.2
pip install mmdet3d==1.1.0
2. ä¸‹è½½é¢„è®­ç»ƒæ¨¡åž‹
# ä¸‹è½½æ¨¡åž‹æƒé‡
mkdir checkpoints
wget https://github.com/OpenDriveLab/UniAD/releases/download/v1.0.0/uniad_base.pth -P checkpoints/

# ä¸‹è½½é…ç½®æ–‡ä»¶
wget https://github.com/OpenDriveLab/UniAD/raw/main/configs/uniad_base.py
3. è¿è¡ŒæŽ¨ç†Demo
# demo_inference.py
import torch
from mmdet3d.apis import inference_detector, init_model

# åˆå§‹åŒ–æ¨¡åž‹
config = &#39;configs/uniad_base.py&#39;
checkpoint = &#39;checkpoints/uniad_base.pth&#39;
model = init_model(config, checkpoint, device=&#39;cuda:0&#39;)

# åŠ è½½ç¤ºä¾‹æ•°æ®
data = dict(
    img_filename=&#39;demo/data/nuscenes/samples/CAM_FRONT/n015-2018-08-02-17-16-37&#43;0800__CAM_FRONT__1533201471912460.jpg&#39;,
    lidar_filename=&#39;demo/data/nuscenes/samples/LIDAR_TOP/n015-2018-08-02-17-16-37&#43;0800__LIDAR_TOP__1533201471912436.pcd.bin&#39;
)

# æŽ¨ç†
result = inference_detector(model, data)

# å¯è§†åŒ–ç»“æžœ
model.show_result(data, result, out_dir=&#39;demo/vis_results&#39;)
4. æŸ¥çœ‹è¾“å‡º
print(&#34;=== UniAD å¤šä»»åŠ¡è¾“å‡º ===&#34;)

# 1. æ£€æµ‹ç»“æžœ
print(f&#34;æ£€æµ‹åˆ° {len(result[&#39;detection&#39;])} ä¸ªç‰©ä½“&#34;)
for i, det in enumerate(result[&#39;detection&#39;][:3]):  # å‰3ä¸ª
    print(f&#34;  ç‰©ä½“{i}: ä½ç½®{det[&#39;bbox_3d&#39;]}, åˆ†æ•°{det[&#39;score&#39;]:.3f}&#34;)

# 2. è½¨è¿¹é¢„æµ‹
print(f&#34;\nè½¨è¿¹é¢„æµ‹:&#34;)
for i, traj in enumerate(result[&#39;motion&#39;][&#39;trajectories&#39;][:2]):  # å‰2ä¸ªæ™ºèƒ½ä½“
    print(f&#34;  æ™ºèƒ½ä½“{i}: {len(traj)} æ¡è½¨è¿¹, æœ€å¯èƒ½è½¨è¿¹ç½®ä¿¡åº¦{result[&#39;motion&#39;][&#39;confidences&#39;][i].max():.3f}&#34;)

# 3. è§„åˆ’ç»“æžœ
plan_traj = result[&#39;planning&#39;][&#39;trajectory&#39;]
print(f&#34;\nè‡ªè½¦è§„åˆ’è½¨è¿¹: {plan_traj.shape} (æ—¶é—´æ­¥Ã—2)&#34;)
print(f&#34;  èµ·ç‚¹: ({plan_traj[0,0]:.1f}, {plan_traj[0,1]:.1f})&#34;)
print(f&#34;  ç»ˆç‚¹: ({plan_traj[-1,0]:.1f}, {plan_traj[-1,1]:.1f})&#34;)

ðŸ’¡ æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹
1. Query-basedç»Ÿä¸€è¡¨ç¤º
# æ‰€æœ‰ä»»åŠ¡å…±äº«Query
queries = QueryEmbedding(num_tasks=5)  # æ£€æµ‹ã€è·Ÿè¸ªã€åœ°å›¾ã€é¢„æµ‹ã€è§„åˆ’

# Queryé—´çš„ä¿¡æ¯æµ
for task in [&#39;det&#39;, &#39;track&#39;, &#39;map&#39;, &#39;motion&#39;, &#39;plan&#39;]:
    task_queries = queries.get_task_queries(task)
    
    # è·¨ä»»åŠ¡æ³¨æ„åŠ›
    for other_task in [&#39;det&#39;, &#39;track&#39;, &#39;map&#39;, &#39;motion&#39;, &#39;plan&#39;]:
        if other_task != task:
            # ä»Žå…¶ä»–ä»»åŠ¡èŽ·å–ä¿¡æ¯
            other_features = queries.get_task_features(other_task)
            task_queries = cross_attention(task_queries, other_features)
    
    # æ›´æ–°æœ¬ä»»åŠ¡è¾“å‡º
    outputstask_queries
2. ä»»åŠ¡é—´æ³¨æ„åŠ›æœºåˆ¶
class CrossTaskAttention(nn.Module):
    &#34;&#34;&#34;è®©ä¸åŒä»»åŠ¡é—´ç›¸äº’é€šä¿¡&#34;&#34;&#34;
    
    def forward(self, query_features, key_features):
        # è®¡ç®—è·¨ä»»åŠ¡æ³¨æ„åŠ›
        attention_weights = torch.matmul(
            query_features, key_features.transpose(-2, -1)
        ) / math.sqrt(self.dim)
        
        # è½¯æ³¨æ„åŠ›
        attention = F.softmax(attention_weights, dim=-1)
        
        # ä¿¡æ¯èžåˆ
        fused_features = torch.matmul(attention, key_features)
        
        return fused_features

ðŸ†š ä¸Žä¼ ç»Ÿæ–¹æ¡ˆå¯¹æ¯”
ä¼ ç»Ÿæ–¹æ¡ˆï¼ˆæ¨¡å—åŒ–ï¼‰
# å„ä¸ªæ¨¡å—ç‹¬ç«‹
perception_output = perception_model(sensor_data)  # æ£€æµ‹è·Ÿè¸ª
prediction_output = prediction_model(perception_output)  # è½¨è¿¹é¢„æµ‹
planning_output = planning_model(perception_output, prediction_output)  # è§„åˆ’

# é—®é¢˜ï¼šè¯¯å·®ä¼ æ’­ã€ä¿¡æ¯æŸå¤±ã€å»¶è¿Ÿç´¯ç§¯
UniADï¼ˆç«¯åˆ°ç«¯ï¼‰
# ç»Ÿä¸€æ¨¡åž‹
all_outputs = uniad_model(sensor_data)  # åŒæ—¶è¾“å‡ºæ‰€æœ‰ç»“æžœ

# ä¼˜åŠ¿ï¼š
# 1. å…±äº«ç‰¹å¾ï¼Œå‡å°‘é‡å¤è®¡ç®—
# 2. è”åˆä¼˜åŒ–ï¼Œé¿å…è¯¯å·®ç´¯ç§¯
# 3. ç«¯åˆ°ç«¯è®­ç»ƒï¼Œç›´æŽ¥ä¼˜åŒ–æœ€ç»ˆç›®æ ‡

ðŸ“ˆ å®žé™…éƒ¨ç½²è€ƒè™‘
è®¡ç®—ä¼˜åŒ–
class UniADLite(nn.Module):
    &#34;&#34;&#34;è½»é‡ç‰ˆUniADï¼Œé€‚åˆéƒ¨ç½²&#34;&#34;&#34;
    
    def __init__(self):
        super().__init__()
        # 1. è½»é‡éª¨å¹²ç½‘ç»œ
        self.backbone = EfficientNetBEV()
        
        # 2. çŸ¥è¯†è’¸é¦
        self.distill_from_teacher()
        
        # 3. é‡åŒ–æ„ŸçŸ¥è®­ç»ƒ
        self.quantize = QuantizeWrapper()
        
        # 4. ä»»åŠ¡å‰ªæžï¼ˆæ ¹æ®éœ€æ±‚é€‰æ‹©ä»»åŠ¡ï¼‰
        self.enabled_tasks = [&#39;detection&#39;, &#39;planning&#39;]  # åªè¿è¡Œå¿…è¦ä»»åŠ¡
    
    def forward(self, x):
        # åŠ¨æ€ä»»åŠ¡é€‰æ‹©
        outputs = {}
        if &#39;detection&#39; in self.enabled_tasks:
            outputs[&#39;detection&#39;] = self.det_head(x)
        if &#39;planning&#39; in self.enabled_tasks:
            outputs[&#39;planning&#39;] = self.plan_head(x)
        # ... å…¶ä»–ä»»åŠ¡
        return outputs

ðŸŽ¯ ä»Šæ—¥å­¦ä¹ ä»»åŠ¡
åŸºç¡€ä»»åŠ¡ï¼ˆ30åˆ†é’Ÿï¼‰ï¼š


é˜…è¯»è®ºæ–‡æ‘˜è¦ï¼ˆ5åˆ†é’Ÿï¼‰" />
  <meta name="author" content="è‡ªåŠ¨é©¾é©¶/æœºå™¨äººå­¦ä¹ ç¬”è®°" /><link rel="preload stylesheet" as="style" href="https://loveppdog.github.io/main.min.569130d9047b717c8997ab0515954414dc24baf46708696a0a28a9ef212cb7e8.css" integrity="sha256-VpEw2QR7cXyJl6sFFZVEFNwkuvRnCGlqCiip7yEst&#43;g=" />

  
  <link rel="preload" as="image" href="https://loveppdog.github.io/theme.png" />

  

  

  <script
    defer
    src="https://loveppdog.github.io/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>

  
  <link
    rel="icon"
    href="https://loveppdog.github.io/favicon.ico"
  />
  <link
    rel="apple-touch-icon"
    href="https://loveppdog.github.io/apple-touch-icon.png"
  />

  <meta name="generator" content="Hugo 0.154.5">
  <meta itemprop="name" content="è‡ªåŠ¨é©¾é©¶/æœºå™¨äººå­¦ä¹ ç¬”è®°">
  <meta itemprop="description" content="ðŸš€ Day 1ï¼šç«¯åˆ°ç«¯è‡ªåŠ¨é©¾é©¶æ¨¡åž‹ - UniAD ðŸ“Œ ä»Šæ—¥å­¦ä¹ æ¨¡åž‹ï¼šUniADï¼ˆUnified Autonomous Drivingï¼‰ ä¸€å¥è¯æ¦‚æ‹¬ï¼šé¦–ä¸ªç«¯åˆ°ç«¯çš„è‡ªåŠ¨é©¾é©¶å…¨æ ˆæ¨¡åž‹ï¼Œç”¨ä¸€ä¸ªç»Ÿä¸€æ¨¡åž‹å¤„ç†æ„ŸçŸ¥ã€é¢„æµ‹ã€è§„åˆ’æ‰€æœ‰ä»»åŠ¡ã€‚
ðŸŽ¯ æ¨¡åž‹åŸºæœ¬ä¿¡æ¯ é¡¹ç›® å†…å®¹ æå‡ºæœºæž„ ä¸Šæµ·äººå·¥æ™ºèƒ½å®žéªŒå®¤ã€é¦™æ¸¯å¤§å­¦ç­‰ å‘è¡¨ä¼šè®® CVPR 2023 (Oral) æ ¸å¿ƒåˆ›æ–° é¦–ä¸ªç«¯åˆ°ç«¯å¯è®­ç»ƒçš„è‡ªåŠ¨é©¾é©¶å…¨æ ˆæ¨¡åž‹ ä»£ç çŠ¶æ€ å·²å¼€æº è®ºæ–‡åœ°å€ https://arxiv.org/abs/2304.05841 GitHub https://github.com/OpenDriveLab/UniAD ðŸ” ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ ä¼ ç»Ÿè‡ªåŠ¨é©¾é©¶æ–¹æ¡ˆçš„é—®é¢˜ï¼š ä¼ ç»Ÿæµæ°´çº¿ï¼šæ„ŸçŸ¥ â†’ é¢„æµ‹ â†’ è§„åˆ’ â†’ æŽ§åˆ¶â†“ â†“ â†“æ¯ä¸ªæ¨¡å—ç‹¬ç«‹è®­ç»ƒã€è¯¯å·®ç´¯ç§¯ã€ä¿¡æ¯æŸå¤± UniADçš„è§£å†³æ–¹æ¡ˆï¼š ç«¯åˆ°ç«¯ï¼šåŽŸå§‹ä¼ æ„Ÿå™¨è¾“å…¥ â†’ ç»Ÿä¸€æ¨¡åž‹ â†’ æŽ§åˆ¶ä¿¡å·â†“å…±äº«ç‰¹å¾ã€è”åˆä¼˜åŒ– ðŸ—ï¸ æ¨¡åž‹æž¶æž„è¯¦è§£ æ•´ä½“æž¶æž„å›¾ [å¤šç›¸æœºå›¾åƒ] / [ç‚¹äº‘]â†“â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ æ„ŸçŸ¥éª¨å¹²ç½‘ç»œ â”‚ â† BEVFormerç­‰â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â†“â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ å¤šä»»åŠ¡Transformerâ”‚ â† æ ¸å¿ƒåˆ›æ–°ï¼â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â†“ â†“ â†“è½¨è¿¹é¢„æµ‹ å æ®é¢„æµ‹ è§„åˆ’ ä»£ç æ¡†æž¶æ¦‚è§ˆ class UniAD(nn.Module): def __init__(self): super().__init__() # 1. ç‰¹å¾æå– self.backbone = BEVFormer() # 2. å¤šä»»åŠ¡è§£ç å™¨ï¼ˆæ ¸å¿ƒï¼‰ self.perception_head = PerceptionHead() # æ£€æµ‹/è·Ÿè¸ª self.map_head = MapHead() # åœ°å›¾ç†è§£ self.occ_head = OccupancyHead() # å æ®é¢„æµ‹ self.motion_head = MotionHead() # è½¨è¿¹é¢„æµ‹ self.planning_head = PlanningHead() # è·¯å¾„è§„åˆ’ def forward(self, images, lidar=None): # æå–BEVç‰¹å¾ bev_features = self.backbone(images) # å¤šä»»åŠ¡å¹¶è¡Œé¢„æµ‹ outputs = { &#39;detection&#39;: self.perception_head(bev_features), &#39;map&#39;: self.map_head(bev_features), &#39;occupancy&#39;: self.occ_head(bev_features), &#39;motion&#39;: self.motion_head(bev_features), &#39;planning&#39;: self.planning_head(bev_features) } return outputs ðŸ§© æ ¸å¿ƒç»„ä»¶è¯¦è§£ 1. æ„ŸçŸ¥æ¨¡å—ï¼ˆPerceptionï¼‰ class PerceptionHead(nn.Module): &#34;&#34;&#34;æ£€æµ‹&#43;è·Ÿè¸ªï¼ŒåŸºäºŽQuery-basedè®¾è®¡&#34;&#34;&#34; def __init__(self, num_queries=100): super().__init__() # Queryåˆå§‹åŒ– self.query_embed = nn.Embedding(num_queries, hidden_dim) # Transformerè§£ç å™¨ self.decoder = TransformerDecoder( num_layers=6, num_heads=8, dim_feedforward=2048 ) def forward(self, bev_features, queries): # ç”¨Queryä¸ŽBEVç‰¹å¾äº¤äº’ outputs = self.decoder(queries, bev_features) # é¢„æµ‹3Dæ¡†ã€é€Ÿåº¦ã€ç±»åˆ«ç­‰ bboxes = self.bbox_head(outputs) scores = self.score_head(outputs) return {&#39;boxes&#39;: bboxes, &#39;scores&#39;: scores} 2. é¢„æµ‹æ¨¡å—ï¼ˆPredictionï¼‰ class MotionHead(nn.Module): &#34;&#34;&#34;è½¨è¿¹é¢„æµ‹ï¼Œè€ƒè™‘å¤šæ™ºèƒ½ä½“äº¤äº’&#34;&#34;&#34; def __init__(self): super().__init__() # åœºæ™¯çº§äº¤äº’å»ºæ¨¡ self.scene_encoder = SceneEncoder() # å¤šæ¨¡æ€è½¨è¿¹ç”Ÿæˆ self.trajectory_decoder = TrajectoryDecoder( num_modes=6, # 6æ¡å¯èƒ½è½¨è¿¹ horizon=12 # é¢„æµ‹æœªæ¥3ç§’ï¼ˆ12å¸§@4Hzï¼‰ ) def forward(self, bev_features, agent_queries): # ç¼–ç åœºæ™¯ä¸Šä¸‹æ–‡ scene_context = self.scene_encoder(bev_features) # ä¸ºæ¯ä¸ªæ™ºèƒ½ä½“é¢„æµ‹å¤šæ¨¡æ€è½¨è¿¹ trajectories = [] confidences = [] for agent_query in agent_queries: # è€ƒè™‘ä¸Žåœºæ™¯å’Œå…¶ä»–æ™ºèƒ½ä½“çš„äº¤äº’ traj, conf = self.trajectory_decoder( agent_query, scene_context ) trajectories.append(traj) confidences.append(conf) return { &#39;trajectories&#39;: trajectories, # [B, N, M, T, 2] &#39;confidences&#39;: confidences # [B, N, M] } 3. è§„åˆ’æ¨¡å—ï¼ˆPlanningï¼‰ class PlanningHead(nn.Module): &#34;&#34;&#34;ç«¯åˆ°ç«¯è·¯å¾„è§„åˆ’&#34;&#34;&#34; def __init__(self, planning_horizon=80): super().__init__() # è‡ªè½¦çŠ¶æ€ç¼–ç  self.ego_encoder = EgoStateEncoder() # åŸºäºŽtransformerçš„è§„åˆ’å™¨ self.planner = TransformerPlanner( hidden_dim=256, num_layers=4, num_heads=8 ) # è½¨è¿¹è§£ç å™¨ self.trajectory_decoder = MLP( input_dim=256, hidden_dims=[512, 256, 128], output_dim=planning_horizon * 2 # (x, y)åæ ‡ ) def forward(self, bev_features, ego_state, goals): &#34;&#34;&#34; ego_state: è‡ªè½¦çŠ¶æ€ [é€Ÿåº¦ã€èˆªå‘è§’ç­‰] goals: å¯èƒ½çš„ç»ˆç‚¹ [å¯é€‰] &#34;&#34;&#34; # ç¼–ç è‡ªè½¦çŠ¶æ€ ego_embedding = self.ego_encoder(ego_state) # ä¸Žåœºæ™¯ç‰¹å¾èžåˆ planning_features = torch.cat([ bev_features.mean(dim=[-2, -1]), # å…¨å±€åœºæ™¯ç‰¹å¾ ego_embedding ], dim=-1) # è§„åˆ’æŽ¨ç† plan_latent = self.planner(planning_features) # è§£ç ä¸ºè½¨è¿¹ trajectory = self.trajectory_decoder(plan_latent) trajectory = trajectory.view(-1, self.planning_horizon, 2) # [B, T, 2] return { &#39;trajectory&#39;: trajectory, &#39;cost_map&#39;: None, # ç«¯åˆ°ç«¯ä¸æ˜¾å¼ç”Ÿæˆä»£ä»·åœ°å›¾ &#39;feasibility&#39;: self.feasibility_head(plan_latent) } ðŸ”„ è®­ç»ƒç­–ç•¥çš„åˆ›æ–° å¤šä»»åŠ¡è”åˆè®­ç»ƒ def multi_task_loss(predictions, ground_truth): &#34;&#34;&#34;ç»Ÿä¸€çš„å¤šä»»åŠ¡æŸå¤±å‡½æ•°&#34;&#34;&#34; losses = {} # 1. æ£€æµ‹æŸå¤± losses[&#39;det&#39;] = detection_loss( predictions[&#39;detection&#39;], ground_truth[&#39;boxes&#39;] ) # 2. è·Ÿè¸ªæŸå¤± losses[&#39;track&#39;] = tracking_loss( predictions[&#39;detection&#39;], ground_truth[&#39;track_ids&#39;] ) # 3. åœ°å›¾ç†è§£æŸå¤± losses[&#39;map&#39;] = map_loss( predictions[&#39;map&#39;], ground_truth[&#39;hdmap&#39;] ) # 4. å æ®é¢„æµ‹æŸå¤± losses[&#39;occ&#39;] = occupancy_loss( predictions[&#39;occupancy&#39;], ground_truth[&#39;occupancy&#39;] ) # 5. è¿åŠ¨é¢„æµ‹æŸå¤± losses[&#39;motion&#39;] = motion_loss( predictions[&#39;motion&#39;], ground_truth[&#39;trajectories&#39;] ) # 6. è§„åˆ’æŸå¤±ï¼ˆå…³é”®ï¼ï¼‰ losses[&#39;plan&#39;] = planning_loss( predictions[&#39;planning&#39;], ground_truth[&#39;ego_trajectory&#39;] ) # åŠ æƒæ±‚å’Œ total_loss = ( losses[&#39;det&#39;] * 1.0 &#43; losses[&#39;track&#39;] * 1.0 &#43; losses[&#39;map&#39;] * 0.5 &#43; losses[&#39;occ&#39;] * 0.5 &#43; losses[&#39;motion&#39;] * 2.0 &#43; losses[&#39;plan&#39;] * 5.0 # è§„åˆ’ä»»åŠ¡æƒé‡æœ€é«˜ ) return total_loss, losses è¯¾ç¨‹å­¦ä¹ ç­–ç•¥ class CurriculumLearning: &#34;&#34;&#34;æ¸è¿›å¼è®­ç»ƒç­–ç•¥&#34;&#34;&#34; def schedule_training(self, epoch): if epoch &lt; 10: # é˜¶æ®µ1ï¼šåªè®­ç»ƒæ„ŸçŸ¥ return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5} elif epoch &lt; 20: # é˜¶æ®µ2ï¼šåŠ å…¥é¢„æµ‹ return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5, &#39;motion&#39;: 1.0} elif epoch &lt; 30: # é˜¶æ®µ3ï¼šåŠ å…¥è§„åˆ’ return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5, &#39;motion&#39;: 2.0, &#39;plan&#39;: 5.0} else: # é˜¶æ®µ4ï¼šå…¨ä»»åŠ¡è”åˆè®­ç»ƒ return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5, &#39;occ&#39;: 0.5, &#39;motion&#39;: 2.0, &#39;plan&#39;: 5.0} ðŸ“Š æ€§èƒ½è¡¨çŽ° åœ¨nuScenesæ•°æ®é›†ä¸Šçš„ç»“æžœ ä»»åŠ¡ | æŒ‡æ ‡ | UniAD | ä¼ ç»ŸSOTA | æå‡---------------|---------------|--------|----------|------3Dæ£€æµ‹ | mAP | 62.4 | 61.3 | &#43;1.1è·Ÿè¸ª | AMOTA | 69.2 | 68.1 | &#43;1.1è½¨è¿¹é¢„æµ‹ | minADEâ‚† | 0.71 | 0.80 | -11.2%å æ®é¢„æµ‹ | IoU | 52.3 | 50.1 | &#43;2.2è§„åˆ’ | L2è¯¯å·®(m) | 0.78 | 0.89 | -12.4%ç¢°æ’žçŽ‡ | â†“ | 0.15% | 0.23% | -34.8% å…³é”®ä¼˜åŠ¿ è¯¯å·®å‡å°‘34%ï¼šç›¸æ¯”æ¨¡å—åŒ–æ–¹æ¡ˆ å®žæ—¶æŽ¨ç†ï¼š120ms/å¸§ï¼ˆRTX 3090ï¼‰ æ³›åŒ–æ€§å¼ºï¼šåœ¨æœªè§è¿‡çš„åœºæ™¯è¡¨çŽ°è‰¯å¥½ ðŸ› ï¸ å¿«é€Ÿå¼€å§‹ï¼ˆ10åˆ†é’Ÿè·‘é€šDemoï¼‰ 1. çŽ¯å¢ƒå®‰è£… # å…‹éš†ä»£ç  git clone https://github.com/OpenDriveLab/UniAD.git cd UniAD # åˆ›å»ºçŽ¯å¢ƒ conda create -n uniad python=3.8 conda activate uniad # å®‰è£…ä¾èµ– pip install torch==1.11.0&#43;cu113 torchvision==0.12.0&#43;cu113 \ torchaudio==0.11.0 --extra-index-url https://download.pytorch.org/whl/cu113 pip install mmcv-full==1.6.0 -f https://download.openmmlab.com/mmcv/dist/cu113/torch1.11.0/index.html pip install -r requirements.txt # å®‰è£…MMDetection3D pip install mmdet==2.28.2 pip install mmdet3d==1.1.0 2. ä¸‹è½½é¢„è®­ç»ƒæ¨¡åž‹ # ä¸‹è½½æ¨¡åž‹æƒé‡ mkdir checkpoints wget https://github.com/OpenDriveLab/UniAD/releases/download/v1.0.0/uniad_base.pth -P checkpoints/ # ä¸‹è½½é…ç½®æ–‡ä»¶ wget https://github.com/OpenDriveLab/UniAD/raw/main/configs/uniad_base.py 3. è¿è¡ŒæŽ¨ç†Demo # demo_inference.py import torch from mmdet3d.apis import inference_detector, init_model # åˆå§‹åŒ–æ¨¡åž‹ config = &#39;configs/uniad_base.py&#39; checkpoint = &#39;checkpoints/uniad_base.pth&#39; model = init_model(config, checkpoint, device=&#39;cuda:0&#39;) # åŠ è½½ç¤ºä¾‹æ•°æ® data = dict( img_filename=&#39;demo/data/nuscenes/samples/CAM_FRONT/n015-2018-08-02-17-16-37&#43;0800__CAM_FRONT__1533201471912460.jpg&#39;, lidar_filename=&#39;demo/data/nuscenes/samples/LIDAR_TOP/n015-2018-08-02-17-16-37&#43;0800__LIDAR_TOP__1533201471912436.pcd.bin&#39; ) # æŽ¨ç† result = inference_detector(model, data) # å¯è§†åŒ–ç»“æžœ model.show_result(data, result, out_dir=&#39;demo/vis_results&#39;) 4. æŸ¥çœ‹è¾“å‡º print(&#34;=== UniAD å¤šä»»åŠ¡è¾“å‡º ===&#34;) # 1. æ£€æµ‹ç»“æžœ print(f&#34;æ£€æµ‹åˆ° {len(result[&#39;detection&#39;])} ä¸ªç‰©ä½“&#34;) for i, det in enumerate(result[&#39;detection&#39;][:3]): # å‰3ä¸ª print(f&#34; ç‰©ä½“{i}: ä½ç½®{det[&#39;bbox_3d&#39;]}, åˆ†æ•°{det[&#39;score&#39;]:.3f}&#34;) # 2. è½¨è¿¹é¢„æµ‹ print(f&#34;\nè½¨è¿¹é¢„æµ‹:&#34;) for i, traj in enumerate(result[&#39;motion&#39;][&#39;trajectories&#39;][:2]): # å‰2ä¸ªæ™ºèƒ½ä½“ print(f&#34; æ™ºèƒ½ä½“{i}: {len(traj)} æ¡è½¨è¿¹, æœ€å¯èƒ½è½¨è¿¹ç½®ä¿¡åº¦{result[&#39;motion&#39;][&#39;confidences&#39;][i].max():.3f}&#34;) # 3. è§„åˆ’ç»“æžœ plan_traj = result[&#39;planning&#39;][&#39;trajectory&#39;] print(f&#34;\nè‡ªè½¦è§„åˆ’è½¨è¿¹: {plan_traj.shape} (æ—¶é—´æ­¥Ã—2)&#34;) print(f&#34; èµ·ç‚¹: ({plan_traj[0,0]:.1f}, {plan_traj[0,1]:.1f})&#34;) print(f&#34; ç»ˆç‚¹: ({plan_traj[-1,0]:.1f}, {plan_traj[-1,1]:.1f})&#34;) ðŸ’¡ æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹ 1. Query-basedç»Ÿä¸€è¡¨ç¤º # æ‰€æœ‰ä»»åŠ¡å…±äº«Query queries = QueryEmbedding(num_tasks=5) # æ£€æµ‹ã€è·Ÿè¸ªã€åœ°å›¾ã€é¢„æµ‹ã€è§„åˆ’ # Queryé—´çš„ä¿¡æ¯æµ for task in [&#39;det&#39;, &#39;track&#39;, &#39;map&#39;, &#39;motion&#39;, &#39;plan&#39;]: task_queries = queries.get_task_queries(task) # è·¨ä»»åŠ¡æ³¨æ„åŠ› for other_task in [&#39;det&#39;, &#39;track&#39;, &#39;map&#39;, &#39;motion&#39;, &#39;plan&#39;]: if other_task != task: # ä»Žå…¶ä»–ä»»åŠ¡èŽ·å–ä¿¡æ¯ other_features = queries.get_task_features(other_task) task_queries = cross_attention(task_queries, other_features) # æ›´æ–°æœ¬ä»»åŠ¡è¾“å‡º outputstask_queries 2. ä»»åŠ¡é—´æ³¨æ„åŠ›æœºåˆ¶ class CrossTaskAttention(nn.Module): &#34;&#34;&#34;è®©ä¸åŒä»»åŠ¡é—´ç›¸äº’é€šä¿¡&#34;&#34;&#34; def forward(self, query_features, key_features): # è®¡ç®—è·¨ä»»åŠ¡æ³¨æ„åŠ› attention_weights = torch.matmul( query_features, key_features.transpose(-2, -1) ) / math.sqrt(self.dim) # è½¯æ³¨æ„åŠ› attention = F.softmax(attention_weights, dim=-1) # ä¿¡æ¯èžåˆ fused_features = torch.matmul(attention, key_features) return fused_features ðŸ†š ä¸Žä¼ ç»Ÿæ–¹æ¡ˆå¯¹æ¯” ä¼ ç»Ÿæ–¹æ¡ˆï¼ˆæ¨¡å—åŒ–ï¼‰ # å„ä¸ªæ¨¡å—ç‹¬ç«‹ perception_output = perception_model(sensor_data) # æ£€æµ‹è·Ÿè¸ª prediction_output = prediction_model(perception_output) # è½¨è¿¹é¢„æµ‹ planning_output = planning_model(perception_output, prediction_output) # è§„åˆ’ # é—®é¢˜ï¼šè¯¯å·®ä¼ æ’­ã€ä¿¡æ¯æŸå¤±ã€å»¶è¿Ÿç´¯ç§¯ UniADï¼ˆç«¯åˆ°ç«¯ï¼‰ # ç»Ÿä¸€æ¨¡åž‹ all_outputs = uniad_model(sensor_data) # åŒæ—¶è¾“å‡ºæ‰€æœ‰ç»“æžœ # ä¼˜åŠ¿ï¼š # 1. å…±äº«ç‰¹å¾ï¼Œå‡å°‘é‡å¤è®¡ç®— # 2. è”åˆä¼˜åŒ–ï¼Œé¿å…è¯¯å·®ç´¯ç§¯ # 3. ç«¯åˆ°ç«¯è®­ç»ƒï¼Œç›´æŽ¥ä¼˜åŒ–æœ€ç»ˆç›®æ ‡ ðŸ“ˆ å®žé™…éƒ¨ç½²è€ƒè™‘ è®¡ç®—ä¼˜åŒ– class UniADLite(nn.Module): &#34;&#34;&#34;è½»é‡ç‰ˆUniADï¼Œé€‚åˆéƒ¨ç½²&#34;&#34;&#34; def __init__(self): super().__init__() # 1. è½»é‡éª¨å¹²ç½‘ç»œ self.backbone = EfficientNetBEV() # 2. çŸ¥è¯†è’¸é¦ self.distill_from_teacher() # 3. é‡åŒ–æ„ŸçŸ¥è®­ç»ƒ self.quantize = QuantizeWrapper() # 4. ä»»åŠ¡å‰ªæžï¼ˆæ ¹æ®éœ€æ±‚é€‰æ‹©ä»»åŠ¡ï¼‰ self.enabled_tasks = [&#39;detection&#39;, &#39;planning&#39;] # åªè¿è¡Œå¿…è¦ä»»åŠ¡ def forward(self, x): # åŠ¨æ€ä»»åŠ¡é€‰æ‹© outputs = {} if &#39;detection&#39; in self.enabled_tasks: outputs[&#39;detection&#39;] = self.det_head(x) if &#39;planning&#39; in self.enabled_tasks: outputs[&#39;planning&#39;] = self.plan_head(x) # ... å…¶ä»–ä»»åŠ¡ return outputs ðŸŽ¯ ä»Šæ—¥å­¦ä¹ ä»»åŠ¡ åŸºç¡€ä»»åŠ¡ï¼ˆ30åˆ†é’Ÿï¼‰ï¼š é˜…è¯»è®ºæ–‡æ‘˜è¦ï¼ˆ5åˆ†é’Ÿï¼‰">
  <meta itemprop="wordCount" content="1019"><meta property="og:url" content="https://loveppdog.github.io/posts/uniad-20260123/">
  <meta property="og:site_name" content="è‡ªåŠ¨é©¾é©¶/æœºå™¨äººå­¦ä¹ ç¬”è®°">
  <meta property="og:title" content="è‡ªåŠ¨é©¾é©¶/æœºå™¨äººå­¦ä¹ ç¬”è®°">
  <meta property="og:description" content="ðŸš€ Day 1ï¼šç«¯åˆ°ç«¯è‡ªåŠ¨é©¾é©¶æ¨¡åž‹ - UniAD ðŸ“Œ ä»Šæ—¥å­¦ä¹ æ¨¡åž‹ï¼šUniADï¼ˆUnified Autonomous Drivingï¼‰ ä¸€å¥è¯æ¦‚æ‹¬ï¼šé¦–ä¸ªç«¯åˆ°ç«¯çš„è‡ªåŠ¨é©¾é©¶å…¨æ ˆæ¨¡åž‹ï¼Œç”¨ä¸€ä¸ªç»Ÿä¸€æ¨¡åž‹å¤„ç†æ„ŸçŸ¥ã€é¢„æµ‹ã€è§„åˆ’æ‰€æœ‰ä»»åŠ¡ã€‚
ðŸŽ¯ æ¨¡åž‹åŸºæœ¬ä¿¡æ¯ é¡¹ç›® å†…å®¹ æå‡ºæœºæž„ ä¸Šæµ·äººå·¥æ™ºèƒ½å®žéªŒå®¤ã€é¦™æ¸¯å¤§å­¦ç­‰ å‘è¡¨ä¼šè®® CVPR 2023 (Oral) æ ¸å¿ƒåˆ›æ–° é¦–ä¸ªç«¯åˆ°ç«¯å¯è®­ç»ƒçš„è‡ªåŠ¨é©¾é©¶å…¨æ ˆæ¨¡åž‹ ä»£ç çŠ¶æ€ å·²å¼€æº è®ºæ–‡åœ°å€ https://arxiv.org/abs/2304.05841 GitHub https://github.com/OpenDriveLab/UniAD ðŸ” ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ ä¼ ç»Ÿè‡ªåŠ¨é©¾é©¶æ–¹æ¡ˆçš„é—®é¢˜ï¼š ä¼ ç»Ÿæµæ°´çº¿ï¼šæ„ŸçŸ¥ â†’ é¢„æµ‹ â†’ è§„åˆ’ â†’ æŽ§åˆ¶â†“ â†“ â†“æ¯ä¸ªæ¨¡å—ç‹¬ç«‹è®­ç»ƒã€è¯¯å·®ç´¯ç§¯ã€ä¿¡æ¯æŸå¤± UniADçš„è§£å†³æ–¹æ¡ˆï¼š ç«¯åˆ°ç«¯ï¼šåŽŸå§‹ä¼ æ„Ÿå™¨è¾“å…¥ â†’ ç»Ÿä¸€æ¨¡åž‹ â†’ æŽ§åˆ¶ä¿¡å·â†“å…±äº«ç‰¹å¾ã€è”åˆä¼˜åŒ– ðŸ—ï¸ æ¨¡åž‹æž¶æž„è¯¦è§£ æ•´ä½“æž¶æž„å›¾ [å¤šç›¸æœºå›¾åƒ] / [ç‚¹äº‘]â†“â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ æ„ŸçŸ¥éª¨å¹²ç½‘ç»œ â”‚ â† BEVFormerç­‰â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â†“â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ å¤šä»»åŠ¡Transformerâ”‚ â† æ ¸å¿ƒåˆ›æ–°ï¼â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â†“ â†“ â†“è½¨è¿¹é¢„æµ‹ å æ®é¢„æµ‹ è§„åˆ’ ä»£ç æ¡†æž¶æ¦‚è§ˆ class UniAD(nn.Module): def __init__(self): super().__init__() # 1. ç‰¹å¾æå– self.backbone = BEVFormer() # 2. å¤šä»»åŠ¡è§£ç å™¨ï¼ˆæ ¸å¿ƒï¼‰ self.perception_head = PerceptionHead() # æ£€æµ‹/è·Ÿè¸ª self.map_head = MapHead() # åœ°å›¾ç†è§£ self.occ_head = OccupancyHead() # å æ®é¢„æµ‹ self.motion_head = MotionHead() # è½¨è¿¹é¢„æµ‹ self.planning_head = PlanningHead() # è·¯å¾„è§„åˆ’ def forward(self, images, lidar=None): # æå–BEVç‰¹å¾ bev_features = self.backbone(images) # å¤šä»»åŠ¡å¹¶è¡Œé¢„æµ‹ outputs = { &#39;detection&#39;: self.perception_head(bev_features), &#39;map&#39;: self.map_head(bev_features), &#39;occupancy&#39;: self.occ_head(bev_features), &#39;motion&#39;: self.motion_head(bev_features), &#39;planning&#39;: self.planning_head(bev_features) } return outputs ðŸ§© æ ¸å¿ƒç»„ä»¶è¯¦è§£ 1. æ„ŸçŸ¥æ¨¡å—ï¼ˆPerceptionï¼‰ class PerceptionHead(nn.Module): &#34;&#34;&#34;æ£€æµ‹&#43;è·Ÿè¸ªï¼ŒåŸºäºŽQuery-basedè®¾è®¡&#34;&#34;&#34; def __init__(self, num_queries=100): super().__init__() # Queryåˆå§‹åŒ– self.query_embed = nn.Embedding(num_queries, hidden_dim) # Transformerè§£ç å™¨ self.decoder = TransformerDecoder( num_layers=6, num_heads=8, dim_feedforward=2048 ) def forward(self, bev_features, queries): # ç”¨Queryä¸ŽBEVç‰¹å¾äº¤äº’ outputs = self.decoder(queries, bev_features) # é¢„æµ‹3Dæ¡†ã€é€Ÿåº¦ã€ç±»åˆ«ç­‰ bboxes = self.bbox_head(outputs) scores = self.score_head(outputs) return {&#39;boxes&#39;: bboxes, &#39;scores&#39;: scores} 2. é¢„æµ‹æ¨¡å—ï¼ˆPredictionï¼‰ class MotionHead(nn.Module): &#34;&#34;&#34;è½¨è¿¹é¢„æµ‹ï¼Œè€ƒè™‘å¤šæ™ºèƒ½ä½“äº¤äº’&#34;&#34;&#34; def __init__(self): super().__init__() # åœºæ™¯çº§äº¤äº’å»ºæ¨¡ self.scene_encoder = SceneEncoder() # å¤šæ¨¡æ€è½¨è¿¹ç”Ÿæˆ self.trajectory_decoder = TrajectoryDecoder( num_modes=6, # 6æ¡å¯èƒ½è½¨è¿¹ horizon=12 # é¢„æµ‹æœªæ¥3ç§’ï¼ˆ12å¸§@4Hzï¼‰ ) def forward(self, bev_features, agent_queries): # ç¼–ç åœºæ™¯ä¸Šä¸‹æ–‡ scene_context = self.scene_encoder(bev_features) # ä¸ºæ¯ä¸ªæ™ºèƒ½ä½“é¢„æµ‹å¤šæ¨¡æ€è½¨è¿¹ trajectories = [] confidences = [] for agent_query in agent_queries: # è€ƒè™‘ä¸Žåœºæ™¯å’Œå…¶ä»–æ™ºèƒ½ä½“çš„äº¤äº’ traj, conf = self.trajectory_decoder( agent_query, scene_context ) trajectories.append(traj) confidences.append(conf) return { &#39;trajectories&#39;: trajectories, # [B, N, M, T, 2] &#39;confidences&#39;: confidences # [B, N, M] } 3. è§„åˆ’æ¨¡å—ï¼ˆPlanningï¼‰ class PlanningHead(nn.Module): &#34;&#34;&#34;ç«¯åˆ°ç«¯è·¯å¾„è§„åˆ’&#34;&#34;&#34; def __init__(self, planning_horizon=80): super().__init__() # è‡ªè½¦çŠ¶æ€ç¼–ç  self.ego_encoder = EgoStateEncoder() # åŸºäºŽtransformerçš„è§„åˆ’å™¨ self.planner = TransformerPlanner( hidden_dim=256, num_layers=4, num_heads=8 ) # è½¨è¿¹è§£ç å™¨ self.trajectory_decoder = MLP( input_dim=256, hidden_dims=[512, 256, 128], output_dim=planning_horizon * 2 # (x, y)åæ ‡ ) def forward(self, bev_features, ego_state, goals): &#34;&#34;&#34; ego_state: è‡ªè½¦çŠ¶æ€ [é€Ÿåº¦ã€èˆªå‘è§’ç­‰] goals: å¯èƒ½çš„ç»ˆç‚¹ [å¯é€‰] &#34;&#34;&#34; # ç¼–ç è‡ªè½¦çŠ¶æ€ ego_embedding = self.ego_encoder(ego_state) # ä¸Žåœºæ™¯ç‰¹å¾èžåˆ planning_features = torch.cat([ bev_features.mean(dim=[-2, -1]), # å…¨å±€åœºæ™¯ç‰¹å¾ ego_embedding ], dim=-1) # è§„åˆ’æŽ¨ç† plan_latent = self.planner(planning_features) # è§£ç ä¸ºè½¨è¿¹ trajectory = self.trajectory_decoder(plan_latent) trajectory = trajectory.view(-1, self.planning_horizon, 2) # [B, T, 2] return { &#39;trajectory&#39;: trajectory, &#39;cost_map&#39;: None, # ç«¯åˆ°ç«¯ä¸æ˜¾å¼ç”Ÿæˆä»£ä»·åœ°å›¾ &#39;feasibility&#39;: self.feasibility_head(plan_latent) } ðŸ”„ è®­ç»ƒç­–ç•¥çš„åˆ›æ–° å¤šä»»åŠ¡è”åˆè®­ç»ƒ def multi_task_loss(predictions, ground_truth): &#34;&#34;&#34;ç»Ÿä¸€çš„å¤šä»»åŠ¡æŸå¤±å‡½æ•°&#34;&#34;&#34; losses = {} # 1. æ£€æµ‹æŸå¤± losses[&#39;det&#39;] = detection_loss( predictions[&#39;detection&#39;], ground_truth[&#39;boxes&#39;] ) # 2. è·Ÿè¸ªæŸå¤± losses[&#39;track&#39;] = tracking_loss( predictions[&#39;detection&#39;], ground_truth[&#39;track_ids&#39;] ) # 3. åœ°å›¾ç†è§£æŸå¤± losses[&#39;map&#39;] = map_loss( predictions[&#39;map&#39;], ground_truth[&#39;hdmap&#39;] ) # 4. å æ®é¢„æµ‹æŸå¤± losses[&#39;occ&#39;] = occupancy_loss( predictions[&#39;occupancy&#39;], ground_truth[&#39;occupancy&#39;] ) # 5. è¿åŠ¨é¢„æµ‹æŸå¤± losses[&#39;motion&#39;] = motion_loss( predictions[&#39;motion&#39;], ground_truth[&#39;trajectories&#39;] ) # 6. è§„åˆ’æŸå¤±ï¼ˆå…³é”®ï¼ï¼‰ losses[&#39;plan&#39;] = planning_loss( predictions[&#39;planning&#39;], ground_truth[&#39;ego_trajectory&#39;] ) # åŠ æƒæ±‚å’Œ total_loss = ( losses[&#39;det&#39;] * 1.0 &#43; losses[&#39;track&#39;] * 1.0 &#43; losses[&#39;map&#39;] * 0.5 &#43; losses[&#39;occ&#39;] * 0.5 &#43; losses[&#39;motion&#39;] * 2.0 &#43; losses[&#39;plan&#39;] * 5.0 # è§„åˆ’ä»»åŠ¡æƒé‡æœ€é«˜ ) return total_loss, losses è¯¾ç¨‹å­¦ä¹ ç­–ç•¥ class CurriculumLearning: &#34;&#34;&#34;æ¸è¿›å¼è®­ç»ƒç­–ç•¥&#34;&#34;&#34; def schedule_training(self, epoch): if epoch &lt; 10: # é˜¶æ®µ1ï¼šåªè®­ç»ƒæ„ŸçŸ¥ return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5} elif epoch &lt; 20: # é˜¶æ®µ2ï¼šåŠ å…¥é¢„æµ‹ return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5, &#39;motion&#39;: 1.0} elif epoch &lt; 30: # é˜¶æ®µ3ï¼šåŠ å…¥è§„åˆ’ return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5, &#39;motion&#39;: 2.0, &#39;plan&#39;: 5.0} else: # é˜¶æ®µ4ï¼šå…¨ä»»åŠ¡è”åˆè®­ç»ƒ return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5, &#39;occ&#39;: 0.5, &#39;motion&#39;: 2.0, &#39;plan&#39;: 5.0} ðŸ“Š æ€§èƒ½è¡¨çŽ° åœ¨nuScenesæ•°æ®é›†ä¸Šçš„ç»“æžœ ä»»åŠ¡ | æŒ‡æ ‡ | UniAD | ä¼ ç»ŸSOTA | æå‡---------------|---------------|--------|----------|------3Dæ£€æµ‹ | mAP | 62.4 | 61.3 | &#43;1.1è·Ÿè¸ª | AMOTA | 69.2 | 68.1 | &#43;1.1è½¨è¿¹é¢„æµ‹ | minADEâ‚† | 0.71 | 0.80 | -11.2%å æ®é¢„æµ‹ | IoU | 52.3 | 50.1 | &#43;2.2è§„åˆ’ | L2è¯¯å·®(m) | 0.78 | 0.89 | -12.4%ç¢°æ’žçŽ‡ | â†“ | 0.15% | 0.23% | -34.8% å…³é”®ä¼˜åŠ¿ è¯¯å·®å‡å°‘34%ï¼šç›¸æ¯”æ¨¡å—åŒ–æ–¹æ¡ˆ å®žæ—¶æŽ¨ç†ï¼š120ms/å¸§ï¼ˆRTX 3090ï¼‰ æ³›åŒ–æ€§å¼ºï¼šåœ¨æœªè§è¿‡çš„åœºæ™¯è¡¨çŽ°è‰¯å¥½ ðŸ› ï¸ å¿«é€Ÿå¼€å§‹ï¼ˆ10åˆ†é’Ÿè·‘é€šDemoï¼‰ 1. çŽ¯å¢ƒå®‰è£… # å…‹éš†ä»£ç  git clone https://github.com/OpenDriveLab/UniAD.git cd UniAD # åˆ›å»ºçŽ¯å¢ƒ conda create -n uniad python=3.8 conda activate uniad # å®‰è£…ä¾èµ– pip install torch==1.11.0&#43;cu113 torchvision==0.12.0&#43;cu113 \ torchaudio==0.11.0 --extra-index-url https://download.pytorch.org/whl/cu113 pip install mmcv-full==1.6.0 -f https://download.openmmlab.com/mmcv/dist/cu113/torch1.11.0/index.html pip install -r requirements.txt # å®‰è£…MMDetection3D pip install mmdet==2.28.2 pip install mmdet3d==1.1.0 2. ä¸‹è½½é¢„è®­ç»ƒæ¨¡åž‹ # ä¸‹è½½æ¨¡åž‹æƒé‡ mkdir checkpoints wget https://github.com/OpenDriveLab/UniAD/releases/download/v1.0.0/uniad_base.pth -P checkpoints/ # ä¸‹è½½é…ç½®æ–‡ä»¶ wget https://github.com/OpenDriveLab/UniAD/raw/main/configs/uniad_base.py 3. è¿è¡ŒæŽ¨ç†Demo # demo_inference.py import torch from mmdet3d.apis import inference_detector, init_model # åˆå§‹åŒ–æ¨¡åž‹ config = &#39;configs/uniad_base.py&#39; checkpoint = &#39;checkpoints/uniad_base.pth&#39; model = init_model(config, checkpoint, device=&#39;cuda:0&#39;) # åŠ è½½ç¤ºä¾‹æ•°æ® data = dict( img_filename=&#39;demo/data/nuscenes/samples/CAM_FRONT/n015-2018-08-02-17-16-37&#43;0800__CAM_FRONT__1533201471912460.jpg&#39;, lidar_filename=&#39;demo/data/nuscenes/samples/LIDAR_TOP/n015-2018-08-02-17-16-37&#43;0800__LIDAR_TOP__1533201471912436.pcd.bin&#39; ) # æŽ¨ç† result = inference_detector(model, data) # å¯è§†åŒ–ç»“æžœ model.show_result(data, result, out_dir=&#39;demo/vis_results&#39;) 4. æŸ¥çœ‹è¾“å‡º print(&#34;=== UniAD å¤šä»»åŠ¡è¾“å‡º ===&#34;) # 1. æ£€æµ‹ç»“æžœ print(f&#34;æ£€æµ‹åˆ° {len(result[&#39;detection&#39;])} ä¸ªç‰©ä½“&#34;) for i, det in enumerate(result[&#39;detection&#39;][:3]): # å‰3ä¸ª print(f&#34; ç‰©ä½“{i}: ä½ç½®{det[&#39;bbox_3d&#39;]}, åˆ†æ•°{det[&#39;score&#39;]:.3f}&#34;) # 2. è½¨è¿¹é¢„æµ‹ print(f&#34;\nè½¨è¿¹é¢„æµ‹:&#34;) for i, traj in enumerate(result[&#39;motion&#39;][&#39;trajectories&#39;][:2]): # å‰2ä¸ªæ™ºèƒ½ä½“ print(f&#34; æ™ºèƒ½ä½“{i}: {len(traj)} æ¡è½¨è¿¹, æœ€å¯èƒ½è½¨è¿¹ç½®ä¿¡åº¦{result[&#39;motion&#39;][&#39;confidences&#39;][i].max():.3f}&#34;) # 3. è§„åˆ’ç»“æžœ plan_traj = result[&#39;planning&#39;][&#39;trajectory&#39;] print(f&#34;\nè‡ªè½¦è§„åˆ’è½¨è¿¹: {plan_traj.shape} (æ—¶é—´æ­¥Ã—2)&#34;) print(f&#34; èµ·ç‚¹: ({plan_traj[0,0]:.1f}, {plan_traj[0,1]:.1f})&#34;) print(f&#34; ç»ˆç‚¹: ({plan_traj[-1,0]:.1f}, {plan_traj[-1,1]:.1f})&#34;) ðŸ’¡ æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹ 1. Query-basedç»Ÿä¸€è¡¨ç¤º # æ‰€æœ‰ä»»åŠ¡å…±äº«Query queries = QueryEmbedding(num_tasks=5) # æ£€æµ‹ã€è·Ÿè¸ªã€åœ°å›¾ã€é¢„æµ‹ã€è§„åˆ’ # Queryé—´çš„ä¿¡æ¯æµ for task in [&#39;det&#39;, &#39;track&#39;, &#39;map&#39;, &#39;motion&#39;, &#39;plan&#39;]: task_queries = queries.get_task_queries(task) # è·¨ä»»åŠ¡æ³¨æ„åŠ› for other_task in [&#39;det&#39;, &#39;track&#39;, &#39;map&#39;, &#39;motion&#39;, &#39;plan&#39;]: if other_task != task: # ä»Žå…¶ä»–ä»»åŠ¡èŽ·å–ä¿¡æ¯ other_features = queries.get_task_features(other_task) task_queries = cross_attention(task_queries, other_features) # æ›´æ–°æœ¬ä»»åŠ¡è¾“å‡º outputstask_queries 2. ä»»åŠ¡é—´æ³¨æ„åŠ›æœºåˆ¶ class CrossTaskAttention(nn.Module): &#34;&#34;&#34;è®©ä¸åŒä»»åŠ¡é—´ç›¸äº’é€šä¿¡&#34;&#34;&#34; def forward(self, query_features, key_features): # è®¡ç®—è·¨ä»»åŠ¡æ³¨æ„åŠ› attention_weights = torch.matmul( query_features, key_features.transpose(-2, -1) ) / math.sqrt(self.dim) # è½¯æ³¨æ„åŠ› attention = F.softmax(attention_weights, dim=-1) # ä¿¡æ¯èžåˆ fused_features = torch.matmul(attention, key_features) return fused_features ðŸ†š ä¸Žä¼ ç»Ÿæ–¹æ¡ˆå¯¹æ¯” ä¼ ç»Ÿæ–¹æ¡ˆï¼ˆæ¨¡å—åŒ–ï¼‰ # å„ä¸ªæ¨¡å—ç‹¬ç«‹ perception_output = perception_model(sensor_data) # æ£€æµ‹è·Ÿè¸ª prediction_output = prediction_model(perception_output) # è½¨è¿¹é¢„æµ‹ planning_output = planning_model(perception_output, prediction_output) # è§„åˆ’ # é—®é¢˜ï¼šè¯¯å·®ä¼ æ’­ã€ä¿¡æ¯æŸå¤±ã€å»¶è¿Ÿç´¯ç§¯ UniADï¼ˆç«¯åˆ°ç«¯ï¼‰ # ç»Ÿä¸€æ¨¡åž‹ all_outputs = uniad_model(sensor_data) # åŒæ—¶è¾“å‡ºæ‰€æœ‰ç»“æžœ # ä¼˜åŠ¿ï¼š # 1. å…±äº«ç‰¹å¾ï¼Œå‡å°‘é‡å¤è®¡ç®— # 2. è”åˆä¼˜åŒ–ï¼Œé¿å…è¯¯å·®ç´¯ç§¯ # 3. ç«¯åˆ°ç«¯è®­ç»ƒï¼Œç›´æŽ¥ä¼˜åŒ–æœ€ç»ˆç›®æ ‡ ðŸ“ˆ å®žé™…éƒ¨ç½²è€ƒè™‘ è®¡ç®—ä¼˜åŒ– class UniADLite(nn.Module): &#34;&#34;&#34;è½»é‡ç‰ˆUniADï¼Œé€‚åˆéƒ¨ç½²&#34;&#34;&#34; def __init__(self): super().__init__() # 1. è½»é‡éª¨å¹²ç½‘ç»œ self.backbone = EfficientNetBEV() # 2. çŸ¥è¯†è’¸é¦ self.distill_from_teacher() # 3. é‡åŒ–æ„ŸçŸ¥è®­ç»ƒ self.quantize = QuantizeWrapper() # 4. ä»»åŠ¡å‰ªæžï¼ˆæ ¹æ®éœ€æ±‚é€‰æ‹©ä»»åŠ¡ï¼‰ self.enabled_tasks = [&#39;detection&#39;, &#39;planning&#39;] # åªè¿è¡Œå¿…è¦ä»»åŠ¡ def forward(self, x): # åŠ¨æ€ä»»åŠ¡é€‰æ‹© outputs = {} if &#39;detection&#39; in self.enabled_tasks: outputs[&#39;detection&#39;] = self.det_head(x) if &#39;planning&#39; in self.enabled_tasks: outputs[&#39;planning&#39;] = self.plan_head(x) # ... å…¶ä»–ä»»åŠ¡ return outputs ðŸŽ¯ ä»Šæ—¥å­¦ä¹ ä»»åŠ¡ åŸºç¡€ä»»åŠ¡ï¼ˆ30åˆ†é’Ÿï¼‰ï¼š é˜…è¯»è®ºæ–‡æ‘˜è¦ï¼ˆ5åˆ†é’Ÿï¼‰">
  <meta property="og:locale" content="zh_cn">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="è‡ªåŠ¨é©¾é©¶/æœºå™¨äººå­¦ä¹ ç¬”è®°">
  <meta name="twitter:description" content="ðŸš€ Day 1ï¼šç«¯åˆ°ç«¯è‡ªåŠ¨é©¾é©¶æ¨¡åž‹ - UniAD ðŸ“Œ ä»Šæ—¥å­¦ä¹ æ¨¡åž‹ï¼šUniADï¼ˆUnified Autonomous Drivingï¼‰ ä¸€å¥è¯æ¦‚æ‹¬ï¼šé¦–ä¸ªç«¯åˆ°ç«¯çš„è‡ªåŠ¨é©¾é©¶å…¨æ ˆæ¨¡åž‹ï¼Œç”¨ä¸€ä¸ªç»Ÿä¸€æ¨¡åž‹å¤„ç†æ„ŸçŸ¥ã€é¢„æµ‹ã€è§„åˆ’æ‰€æœ‰ä»»åŠ¡ã€‚
ðŸŽ¯ æ¨¡åž‹åŸºæœ¬ä¿¡æ¯ é¡¹ç›® å†…å®¹ æå‡ºæœºæž„ ä¸Šæµ·äººå·¥æ™ºèƒ½å®žéªŒå®¤ã€é¦™æ¸¯å¤§å­¦ç­‰ å‘è¡¨ä¼šè®® CVPR 2023 (Oral) æ ¸å¿ƒåˆ›æ–° é¦–ä¸ªç«¯åˆ°ç«¯å¯è®­ç»ƒçš„è‡ªåŠ¨é©¾é©¶å…¨æ ˆæ¨¡åž‹ ä»£ç çŠ¶æ€ å·²å¼€æº è®ºæ–‡åœ°å€ https://arxiv.org/abs/2304.05841 GitHub https://github.com/OpenDriveLab/UniAD ðŸ” ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ ä¼ ç»Ÿè‡ªåŠ¨é©¾é©¶æ–¹æ¡ˆçš„é—®é¢˜ï¼š ä¼ ç»Ÿæµæ°´çº¿ï¼šæ„ŸçŸ¥ â†’ é¢„æµ‹ â†’ è§„åˆ’ â†’ æŽ§åˆ¶â†“ â†“ â†“æ¯ä¸ªæ¨¡å—ç‹¬ç«‹è®­ç»ƒã€è¯¯å·®ç´¯ç§¯ã€ä¿¡æ¯æŸå¤± UniADçš„è§£å†³æ–¹æ¡ˆï¼š ç«¯åˆ°ç«¯ï¼šåŽŸå§‹ä¼ æ„Ÿå™¨è¾“å…¥ â†’ ç»Ÿä¸€æ¨¡åž‹ â†’ æŽ§åˆ¶ä¿¡å·â†“å…±äº«ç‰¹å¾ã€è”åˆä¼˜åŒ– ðŸ—ï¸ æ¨¡åž‹æž¶æž„è¯¦è§£ æ•´ä½“æž¶æž„å›¾ [å¤šç›¸æœºå›¾åƒ] / [ç‚¹äº‘]â†“â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ æ„ŸçŸ¥éª¨å¹²ç½‘ç»œ â”‚ â† BEVFormerç­‰â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â†“â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚ å¤šä»»åŠ¡Transformerâ”‚ â† æ ¸å¿ƒåˆ›æ–°ï¼â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â†“ â†“ â†“è½¨è¿¹é¢„æµ‹ å æ®é¢„æµ‹ è§„åˆ’ ä»£ç æ¡†æž¶æ¦‚è§ˆ class UniAD(nn.Module): def __init__(self): super().__init__() # 1. ç‰¹å¾æå– self.backbone = BEVFormer() # 2. å¤šä»»åŠ¡è§£ç å™¨ï¼ˆæ ¸å¿ƒï¼‰ self.perception_head = PerceptionHead() # æ£€æµ‹/è·Ÿè¸ª self.map_head = MapHead() # åœ°å›¾ç†è§£ self.occ_head = OccupancyHead() # å æ®é¢„æµ‹ self.motion_head = MotionHead() # è½¨è¿¹é¢„æµ‹ self.planning_head = PlanningHead() # è·¯å¾„è§„åˆ’ def forward(self, images, lidar=None): # æå–BEVç‰¹å¾ bev_features = self.backbone(images) # å¤šä»»åŠ¡å¹¶è¡Œé¢„æµ‹ outputs = { &#39;detection&#39;: self.perception_head(bev_features), &#39;map&#39;: self.map_head(bev_features), &#39;occupancy&#39;: self.occ_head(bev_features), &#39;motion&#39;: self.motion_head(bev_features), &#39;planning&#39;: self.planning_head(bev_features) } return outputs ðŸ§© æ ¸å¿ƒç»„ä»¶è¯¦è§£ 1. æ„ŸçŸ¥æ¨¡å—ï¼ˆPerceptionï¼‰ class PerceptionHead(nn.Module): &#34;&#34;&#34;æ£€æµ‹&#43;è·Ÿè¸ªï¼ŒåŸºäºŽQuery-basedè®¾è®¡&#34;&#34;&#34; def __init__(self, num_queries=100): super().__init__() # Queryåˆå§‹åŒ– self.query_embed = nn.Embedding(num_queries, hidden_dim) # Transformerè§£ç å™¨ self.decoder = TransformerDecoder( num_layers=6, num_heads=8, dim_feedforward=2048 ) def forward(self, bev_features, queries): # ç”¨Queryä¸ŽBEVç‰¹å¾äº¤äº’ outputs = self.decoder(queries, bev_features) # é¢„æµ‹3Dæ¡†ã€é€Ÿåº¦ã€ç±»åˆ«ç­‰ bboxes = self.bbox_head(outputs) scores = self.score_head(outputs) return {&#39;boxes&#39;: bboxes, &#39;scores&#39;: scores} 2. é¢„æµ‹æ¨¡å—ï¼ˆPredictionï¼‰ class MotionHead(nn.Module): &#34;&#34;&#34;è½¨è¿¹é¢„æµ‹ï¼Œè€ƒè™‘å¤šæ™ºèƒ½ä½“äº¤äº’&#34;&#34;&#34; def __init__(self): super().__init__() # åœºæ™¯çº§äº¤äº’å»ºæ¨¡ self.scene_encoder = SceneEncoder() # å¤šæ¨¡æ€è½¨è¿¹ç”Ÿæˆ self.trajectory_decoder = TrajectoryDecoder( num_modes=6, # 6æ¡å¯èƒ½è½¨è¿¹ horizon=12 # é¢„æµ‹æœªæ¥3ç§’ï¼ˆ12å¸§@4Hzï¼‰ ) def forward(self, bev_features, agent_queries): # ç¼–ç åœºæ™¯ä¸Šä¸‹æ–‡ scene_context = self.scene_encoder(bev_features) # ä¸ºæ¯ä¸ªæ™ºèƒ½ä½“é¢„æµ‹å¤šæ¨¡æ€è½¨è¿¹ trajectories = [] confidences = [] for agent_query in agent_queries: # è€ƒè™‘ä¸Žåœºæ™¯å’Œå…¶ä»–æ™ºèƒ½ä½“çš„äº¤äº’ traj, conf = self.trajectory_decoder( agent_query, scene_context ) trajectories.append(traj) confidences.append(conf) return { &#39;trajectories&#39;: trajectories, # [B, N, M, T, 2] &#39;confidences&#39;: confidences # [B, N, M] } 3. è§„åˆ’æ¨¡å—ï¼ˆPlanningï¼‰ class PlanningHead(nn.Module): &#34;&#34;&#34;ç«¯åˆ°ç«¯è·¯å¾„è§„åˆ’&#34;&#34;&#34; def __init__(self, planning_horizon=80): super().__init__() # è‡ªè½¦çŠ¶æ€ç¼–ç  self.ego_encoder = EgoStateEncoder() # åŸºäºŽtransformerçš„è§„åˆ’å™¨ self.planner = TransformerPlanner( hidden_dim=256, num_layers=4, num_heads=8 ) # è½¨è¿¹è§£ç å™¨ self.trajectory_decoder = MLP( input_dim=256, hidden_dims=[512, 256, 128], output_dim=planning_horizon * 2 # (x, y)åæ ‡ ) def forward(self, bev_features, ego_state, goals): &#34;&#34;&#34; ego_state: è‡ªè½¦çŠ¶æ€ [é€Ÿåº¦ã€èˆªå‘è§’ç­‰] goals: å¯èƒ½çš„ç»ˆç‚¹ [å¯é€‰] &#34;&#34;&#34; # ç¼–ç è‡ªè½¦çŠ¶æ€ ego_embedding = self.ego_encoder(ego_state) # ä¸Žåœºæ™¯ç‰¹å¾èžåˆ planning_features = torch.cat([ bev_features.mean(dim=[-2, -1]), # å…¨å±€åœºæ™¯ç‰¹å¾ ego_embedding ], dim=-1) # è§„åˆ’æŽ¨ç† plan_latent = self.planner(planning_features) # è§£ç ä¸ºè½¨è¿¹ trajectory = self.trajectory_decoder(plan_latent) trajectory = trajectory.view(-1, self.planning_horizon, 2) # [B, T, 2] return { &#39;trajectory&#39;: trajectory, &#39;cost_map&#39;: None, # ç«¯åˆ°ç«¯ä¸æ˜¾å¼ç”Ÿæˆä»£ä»·åœ°å›¾ &#39;feasibility&#39;: self.feasibility_head(plan_latent) } ðŸ”„ è®­ç»ƒç­–ç•¥çš„åˆ›æ–° å¤šä»»åŠ¡è”åˆè®­ç»ƒ def multi_task_loss(predictions, ground_truth): &#34;&#34;&#34;ç»Ÿä¸€çš„å¤šä»»åŠ¡æŸå¤±å‡½æ•°&#34;&#34;&#34; losses = {} # 1. æ£€æµ‹æŸå¤± losses[&#39;det&#39;] = detection_loss( predictions[&#39;detection&#39;], ground_truth[&#39;boxes&#39;] ) # 2. è·Ÿè¸ªæŸå¤± losses[&#39;track&#39;] = tracking_loss( predictions[&#39;detection&#39;], ground_truth[&#39;track_ids&#39;] ) # 3. åœ°å›¾ç†è§£æŸå¤± losses[&#39;map&#39;] = map_loss( predictions[&#39;map&#39;], ground_truth[&#39;hdmap&#39;] ) # 4. å æ®é¢„æµ‹æŸå¤± losses[&#39;occ&#39;] = occupancy_loss( predictions[&#39;occupancy&#39;], ground_truth[&#39;occupancy&#39;] ) # 5. è¿åŠ¨é¢„æµ‹æŸå¤± losses[&#39;motion&#39;] = motion_loss( predictions[&#39;motion&#39;], ground_truth[&#39;trajectories&#39;] ) # 6. è§„åˆ’æŸå¤±ï¼ˆå…³é”®ï¼ï¼‰ losses[&#39;plan&#39;] = planning_loss( predictions[&#39;planning&#39;], ground_truth[&#39;ego_trajectory&#39;] ) # åŠ æƒæ±‚å’Œ total_loss = ( losses[&#39;det&#39;] * 1.0 &#43; losses[&#39;track&#39;] * 1.0 &#43; losses[&#39;map&#39;] * 0.5 &#43; losses[&#39;occ&#39;] * 0.5 &#43; losses[&#39;motion&#39;] * 2.0 &#43; losses[&#39;plan&#39;] * 5.0 # è§„åˆ’ä»»åŠ¡æƒé‡æœ€é«˜ ) return total_loss, losses è¯¾ç¨‹å­¦ä¹ ç­–ç•¥ class CurriculumLearning: &#34;&#34;&#34;æ¸è¿›å¼è®­ç»ƒç­–ç•¥&#34;&#34;&#34; def schedule_training(self, epoch): if epoch &lt; 10: # é˜¶æ®µ1ï¼šåªè®­ç»ƒæ„ŸçŸ¥ return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5} elif epoch &lt; 20: # é˜¶æ®µ2ï¼šåŠ å…¥é¢„æµ‹ return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5, &#39;motion&#39;: 1.0} elif epoch &lt; 30: # é˜¶æ®µ3ï¼šåŠ å…¥è§„åˆ’ return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5, &#39;motion&#39;: 2.0, &#39;plan&#39;: 5.0} else: # é˜¶æ®µ4ï¼šå…¨ä»»åŠ¡è”åˆè®­ç»ƒ return {&#39;det&#39;: 1.0, &#39;track&#39;: 1.0, &#39;map&#39;: 0.5, &#39;occ&#39;: 0.5, &#39;motion&#39;: 2.0, &#39;plan&#39;: 5.0} ðŸ“Š æ€§èƒ½è¡¨çŽ° åœ¨nuScenesæ•°æ®é›†ä¸Šçš„ç»“æžœ ä»»åŠ¡ | æŒ‡æ ‡ | UniAD | ä¼ ç»ŸSOTA | æå‡---------------|---------------|--------|----------|------3Dæ£€æµ‹ | mAP | 62.4 | 61.3 | &#43;1.1è·Ÿè¸ª | AMOTA | 69.2 | 68.1 | &#43;1.1è½¨è¿¹é¢„æµ‹ | minADEâ‚† | 0.71 | 0.80 | -11.2%å æ®é¢„æµ‹ | IoU | 52.3 | 50.1 | &#43;2.2è§„åˆ’ | L2è¯¯å·®(m) | 0.78 | 0.89 | -12.4%ç¢°æ’žçŽ‡ | â†“ | 0.15% | 0.23% | -34.8% å…³é”®ä¼˜åŠ¿ è¯¯å·®å‡å°‘34%ï¼šç›¸æ¯”æ¨¡å—åŒ–æ–¹æ¡ˆ å®žæ—¶æŽ¨ç†ï¼š120ms/å¸§ï¼ˆRTX 3090ï¼‰ æ³›åŒ–æ€§å¼ºï¼šåœ¨æœªè§è¿‡çš„åœºæ™¯è¡¨çŽ°è‰¯å¥½ ðŸ› ï¸ å¿«é€Ÿå¼€å§‹ï¼ˆ10åˆ†é’Ÿè·‘é€šDemoï¼‰ 1. çŽ¯å¢ƒå®‰è£… # å…‹éš†ä»£ç  git clone https://github.com/OpenDriveLab/UniAD.git cd UniAD # åˆ›å»ºçŽ¯å¢ƒ conda create -n uniad python=3.8 conda activate uniad # å®‰è£…ä¾èµ– pip install torch==1.11.0&#43;cu113 torchvision==0.12.0&#43;cu113 \ torchaudio==0.11.0 --extra-index-url https://download.pytorch.org/whl/cu113 pip install mmcv-full==1.6.0 -f https://download.openmmlab.com/mmcv/dist/cu113/torch1.11.0/index.html pip install -r requirements.txt # å®‰è£…MMDetection3D pip install mmdet==2.28.2 pip install mmdet3d==1.1.0 2. ä¸‹è½½é¢„è®­ç»ƒæ¨¡åž‹ # ä¸‹è½½æ¨¡åž‹æƒé‡ mkdir checkpoints wget https://github.com/OpenDriveLab/UniAD/releases/download/v1.0.0/uniad_base.pth -P checkpoints/ # ä¸‹è½½é…ç½®æ–‡ä»¶ wget https://github.com/OpenDriveLab/UniAD/raw/main/configs/uniad_base.py 3. è¿è¡ŒæŽ¨ç†Demo # demo_inference.py import torch from mmdet3d.apis import inference_detector, init_model # åˆå§‹åŒ–æ¨¡åž‹ config = &#39;configs/uniad_base.py&#39; checkpoint = &#39;checkpoints/uniad_base.pth&#39; model = init_model(config, checkpoint, device=&#39;cuda:0&#39;) # åŠ è½½ç¤ºä¾‹æ•°æ® data = dict( img_filename=&#39;demo/data/nuscenes/samples/CAM_FRONT/n015-2018-08-02-17-16-37&#43;0800__CAM_FRONT__1533201471912460.jpg&#39;, lidar_filename=&#39;demo/data/nuscenes/samples/LIDAR_TOP/n015-2018-08-02-17-16-37&#43;0800__LIDAR_TOP__1533201471912436.pcd.bin&#39; ) # æŽ¨ç† result = inference_detector(model, data) # å¯è§†åŒ–ç»“æžœ model.show_result(data, result, out_dir=&#39;demo/vis_results&#39;) 4. æŸ¥çœ‹è¾“å‡º print(&#34;=== UniAD å¤šä»»åŠ¡è¾“å‡º ===&#34;) # 1. æ£€æµ‹ç»“æžœ print(f&#34;æ£€æµ‹åˆ° {len(result[&#39;detection&#39;])} ä¸ªç‰©ä½“&#34;) for i, det in enumerate(result[&#39;detection&#39;][:3]): # å‰3ä¸ª print(f&#34; ç‰©ä½“{i}: ä½ç½®{det[&#39;bbox_3d&#39;]}, åˆ†æ•°{det[&#39;score&#39;]:.3f}&#34;) # 2. è½¨è¿¹é¢„æµ‹ print(f&#34;\nè½¨è¿¹é¢„æµ‹:&#34;) for i, traj in enumerate(result[&#39;motion&#39;][&#39;trajectories&#39;][:2]): # å‰2ä¸ªæ™ºèƒ½ä½“ print(f&#34; æ™ºèƒ½ä½“{i}: {len(traj)} æ¡è½¨è¿¹, æœ€å¯èƒ½è½¨è¿¹ç½®ä¿¡åº¦{result[&#39;motion&#39;][&#39;confidences&#39;][i].max():.3f}&#34;) # 3. è§„åˆ’ç»“æžœ plan_traj = result[&#39;planning&#39;][&#39;trajectory&#39;] print(f&#34;\nè‡ªè½¦è§„åˆ’è½¨è¿¹: {plan_traj.shape} (æ—¶é—´æ­¥Ã—2)&#34;) print(f&#34; èµ·ç‚¹: ({plan_traj[0,0]:.1f}, {plan_traj[0,1]:.1f})&#34;) print(f&#34; ç»ˆç‚¹: ({plan_traj[-1,0]:.1f}, {plan_traj[-1,1]:.1f})&#34;) ðŸ’¡ æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹ 1. Query-basedç»Ÿä¸€è¡¨ç¤º # æ‰€æœ‰ä»»åŠ¡å…±äº«Query queries = QueryEmbedding(num_tasks=5) # æ£€æµ‹ã€è·Ÿè¸ªã€åœ°å›¾ã€é¢„æµ‹ã€è§„åˆ’ # Queryé—´çš„ä¿¡æ¯æµ for task in [&#39;det&#39;, &#39;track&#39;, &#39;map&#39;, &#39;motion&#39;, &#39;plan&#39;]: task_queries = queries.get_task_queries(task) # è·¨ä»»åŠ¡æ³¨æ„åŠ› for other_task in [&#39;det&#39;, &#39;track&#39;, &#39;map&#39;, &#39;motion&#39;, &#39;plan&#39;]: if other_task != task: # ä»Žå…¶ä»–ä»»åŠ¡èŽ·å–ä¿¡æ¯ other_features = queries.get_task_features(other_task) task_queries = cross_attention(task_queries, other_features) # æ›´æ–°æœ¬ä»»åŠ¡è¾“å‡º outputstask_queries 2. ä»»åŠ¡é—´æ³¨æ„åŠ›æœºåˆ¶ class CrossTaskAttention(nn.Module): &#34;&#34;&#34;è®©ä¸åŒä»»åŠ¡é—´ç›¸äº’é€šä¿¡&#34;&#34;&#34; def forward(self, query_features, key_features): # è®¡ç®—è·¨ä»»åŠ¡æ³¨æ„åŠ› attention_weights = torch.matmul( query_features, key_features.transpose(-2, -1) ) / math.sqrt(self.dim) # è½¯æ³¨æ„åŠ› attention = F.softmax(attention_weights, dim=-1) # ä¿¡æ¯èžåˆ fused_features = torch.matmul(attention, key_features) return fused_features ðŸ†š ä¸Žä¼ ç»Ÿæ–¹æ¡ˆå¯¹æ¯” ä¼ ç»Ÿæ–¹æ¡ˆï¼ˆæ¨¡å—åŒ–ï¼‰ # å„ä¸ªæ¨¡å—ç‹¬ç«‹ perception_output = perception_model(sensor_data) # æ£€æµ‹è·Ÿè¸ª prediction_output = prediction_model(perception_output) # è½¨è¿¹é¢„æµ‹ planning_output = planning_model(perception_output, prediction_output) # è§„åˆ’ # é—®é¢˜ï¼šè¯¯å·®ä¼ æ’­ã€ä¿¡æ¯æŸå¤±ã€å»¶è¿Ÿç´¯ç§¯ UniADï¼ˆç«¯åˆ°ç«¯ï¼‰ # ç»Ÿä¸€æ¨¡åž‹ all_outputs = uniad_model(sensor_data) # åŒæ—¶è¾“å‡ºæ‰€æœ‰ç»“æžœ # ä¼˜åŠ¿ï¼š # 1. å…±äº«ç‰¹å¾ï¼Œå‡å°‘é‡å¤è®¡ç®— # 2. è”åˆä¼˜åŒ–ï¼Œé¿å…è¯¯å·®ç´¯ç§¯ # 3. ç«¯åˆ°ç«¯è®­ç»ƒï¼Œç›´æŽ¥ä¼˜åŒ–æœ€ç»ˆç›®æ ‡ ðŸ“ˆ å®žé™…éƒ¨ç½²è€ƒè™‘ è®¡ç®—ä¼˜åŒ– class UniADLite(nn.Module): &#34;&#34;&#34;è½»é‡ç‰ˆUniADï¼Œé€‚åˆéƒ¨ç½²&#34;&#34;&#34; def __init__(self): super().__init__() # 1. è½»é‡éª¨å¹²ç½‘ç»œ self.backbone = EfficientNetBEV() # 2. çŸ¥è¯†è’¸é¦ self.distill_from_teacher() # 3. é‡åŒ–æ„ŸçŸ¥è®­ç»ƒ self.quantize = QuantizeWrapper() # 4. ä»»åŠ¡å‰ªæžï¼ˆæ ¹æ®éœ€æ±‚é€‰æ‹©ä»»åŠ¡ï¼‰ self.enabled_tasks = [&#39;detection&#39;, &#39;planning&#39;] # åªè¿è¡Œå¿…è¦ä»»åŠ¡ def forward(self, x): # åŠ¨æ€ä»»åŠ¡é€‰æ‹© outputs = {} if &#39;detection&#39; in self.enabled_tasks: outputs[&#39;detection&#39;] = self.det_head(x) if &#39;planning&#39; in self.enabled_tasks: outputs[&#39;planning&#39;] = self.plan_head(x) # ... å…¶ä»–ä»»åŠ¡ return outputs ðŸŽ¯ ä»Šæ—¥å­¦ä¹ ä»»åŠ¡ åŸºç¡€ä»»åŠ¡ï¼ˆ30åˆ†é’Ÿï¼‰ï¼š é˜…è¯»è®ºæ–‡æ‘˜è¦ï¼ˆ5åˆ†é’Ÿï¼‰">

  <link rel="canonical" href="https://loveppdog.github.io/posts/uniad-20260123/" />
</head>
<body
    class="bg-(--bg) text-black antialiased duration-200 ease-out [-webkit-tap-highlight-color:transparent] dark:text-white"
  ><header
  class="mx-auto flex h-[4.5rem] max-w-(--w) px-8 whitespace-nowrap lg:justify-center"
>
  <div class="relative z-50 flex items-center ltr:mr-auto rtl:ml-auto">
    <a
      class="-translate-y-[1px] text-2xl font-medium"
      href="https://loveppdog.github.io/"
      >è‡ªåŠ¨é©¾é©¶/æœºå™¨äººå­¦ä¹ ç¬”è®°</a
    >
    <div
      class="btn-dark text-[0px] ltr:ml-4 rtl:mr-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"
      role="button"
      aria-label="Dark"
    ></div>
  </div>

  <div
    class="btn-menu relative z-50 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden ltr:-mr-8 rtl:-ml-8"
    role="button"
    aria-label="Menu"
  ></div>

  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = '#faf8f1'.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? "rgb(0 0 0 / 85%)" : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full flex-col justify-center bg-(--bg) pb-16 duration-200 select-none lg:static lg:h-auto lg:flex-row lg:bg-transparent! lg:pb-0 lg:transition-none"
  >
  </div>
</header>
<main
      class="prose prose-neutral dark:prose-invert relative mx-auto min-h-[calc(100vh-9rem)] max-w-(--w) px-8 pt-14 pb-16"
    ><article>
  <header class="mb-14">
    <h1 class="my-0! pb-2.5"></h1><div class="text-xs antialiased opacity-60"></div></header>

  <section><h1 id="-day-1ç«¯åˆ°ç«¯è‡ªåŠ¨é©¾é©¶æ¨¡åž‹---uniad">ðŸš€ <strong>Day 1ï¼šç«¯åˆ°ç«¯è‡ªåŠ¨é©¾é©¶æ¨¡åž‹ - UniAD</strong></h1>
<h2 id="-ä»Šæ—¥å­¦ä¹ æ¨¡åž‹uniadunified-autonomous-driving">ðŸ“Œ <strong>ä»Šæ—¥å­¦ä¹ æ¨¡åž‹ï¼šUniADï¼ˆUnified Autonomous Drivingï¼‰</strong></h2>
<p><strong>ä¸€å¥è¯æ¦‚æ‹¬</strong>ï¼šé¦–ä¸ª<strong>ç«¯åˆ°ç«¯</strong>çš„è‡ªåŠ¨é©¾é©¶å…¨æ ˆæ¨¡åž‹ï¼Œç”¨ä¸€ä¸ªç»Ÿä¸€æ¨¡åž‹å¤„ç†æ„ŸçŸ¥ã€é¢„æµ‹ã€è§„åˆ’æ‰€æœ‰ä»»åŠ¡ã€‚</p>
<hr>
<h2 id="-æ¨¡åž‹åŸºæœ¬ä¿¡æ¯">ðŸŽ¯ <strong>æ¨¡åž‹åŸºæœ¬ä¿¡æ¯</strong></h2>
<table>
  <thead>
      <tr>
          <th>é¡¹ç›®</th>
          <th>å†…å®¹</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><strong>æå‡ºæœºæž„</strong></td>
          <td>ä¸Šæµ·äººå·¥æ™ºèƒ½å®žéªŒå®¤ã€é¦™æ¸¯å¤§å­¦ç­‰</td>
      </tr>
      <tr>
          <td><strong>å‘è¡¨ä¼šè®®</strong></td>
          <td>CVPR 2023 (Oral)</td>
      </tr>
      <tr>
          <td><strong>æ ¸å¿ƒåˆ›æ–°</strong></td>
          <td>é¦–ä¸ªç«¯åˆ°ç«¯å¯è®­ç»ƒçš„è‡ªåŠ¨é©¾é©¶å…¨æ ˆæ¨¡åž‹</td>
      </tr>
      <tr>
          <td><strong>ä»£ç çŠ¶æ€</strong></td>
          <td>å·²å¼€æº</td>
      </tr>
      <tr>
          <td><strong>è®ºæ–‡åœ°å€</strong></td>
          <td><a href="https://arxiv.org/abs/2304.05841">https://arxiv.org/abs/2304.05841</a></td>
      </tr>
      <tr>
          <td><strong>GitHub</strong></td>
          <td><a href="https://github.com/OpenDriveLab/UniAD">https://github.com/OpenDriveLab/UniAD</a></td>
      </tr>
  </tbody>
</table>
<hr>
<h2 id="-ä¸ºä»€ä¹ˆé‡è¦">ðŸ” <strong>ä¸ºä»€ä¹ˆé‡è¦ï¼Ÿ</strong></h2>
<h3 id="ä¼ ç»Ÿè‡ªåŠ¨é©¾é©¶æ–¹æ¡ˆçš„é—®é¢˜">ä¼ ç»Ÿè‡ªåŠ¨é©¾é©¶æ–¹æ¡ˆçš„é—®é¢˜ï¼š</h3>
<pre tabindex="0"><code>ä¼ ç»Ÿæµæ°´çº¿ï¼š
æ„ŸçŸ¥ â†’ é¢„æµ‹ â†’ è§„åˆ’ â†’ æŽ§åˆ¶
    â†“      â†“      â†“
æ¯ä¸ªæ¨¡å—ç‹¬ç«‹è®­ç»ƒã€è¯¯å·®ç´¯ç§¯ã€ä¿¡æ¯æŸå¤±
</code></pre><h3 id="uniadçš„è§£å†³æ–¹æ¡ˆ">UniADçš„è§£å†³æ–¹æ¡ˆï¼š</h3>
<pre tabindex="0"><code>ç«¯åˆ°ç«¯ï¼š
åŽŸå§‹ä¼ æ„Ÿå™¨è¾“å…¥ â†’ ç»Ÿä¸€æ¨¡åž‹ â†’ æŽ§åˆ¶ä¿¡å·
           â†“
   å…±äº«ç‰¹å¾ã€è”åˆä¼˜åŒ–
</code></pre><hr>
<h2 id="-æ¨¡åž‹æž¶æž„è¯¦è§£">ðŸ—ï¸ <strong>æ¨¡åž‹æž¶æž„è¯¦è§£</strong></h2>
<h3 id="æ•´ä½“æž¶æž„å›¾">æ•´ä½“æž¶æž„å›¾</h3>
<pre tabindex="0"><code>         [å¤šç›¸æœºå›¾åƒ] / [ç‚¹äº‘]
                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  æ„ŸçŸ¥éª¨å¹²ç½‘ç»œ   â”‚ â† BEVFormerç­‰
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ å¤šä»»åŠ¡Transformerâ”‚ â† æ ¸å¿ƒåˆ›æ–°ï¼
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“      â†“      â†“
      è½¨è¿¹é¢„æµ‹  å æ®é¢„æµ‹  è§„åˆ’
</code></pre><h3 id="ä»£ç æ¡†æž¶æ¦‚è§ˆ">ä»£ç æ¡†æž¶æ¦‚è§ˆ</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UniAD</span>(nn<span style="color:#f92672">.</span>Module):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        super()<span style="color:#f92672">.</span><span style="color:#a6e22e">__init__</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 1. ç‰¹å¾æå–</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>backbone <span style="color:#f92672">=</span> BEVFormer()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 2. å¤šä»»åŠ¡è§£ç å™¨ï¼ˆæ ¸å¿ƒï¼‰</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>perception_head <span style="color:#f92672">=</span> PerceptionHead()      <span style="color:#75715e"># æ£€æµ‹/è·Ÿè¸ª</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>map_head <span style="color:#f92672">=</span> MapHead()                    <span style="color:#75715e"># åœ°å›¾ç†è§£</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>occ_head <span style="color:#f92672">=</span> OccupancyHead()              <span style="color:#75715e"># å æ®é¢„æµ‹</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>motion_head <span style="color:#f92672">=</span> MotionHead()              <span style="color:#75715e"># è½¨è¿¹é¢„æµ‹</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>planning_head <span style="color:#f92672">=</span> PlanningHead()          <span style="color:#75715e"># è·¯å¾„è§„åˆ’</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">forward</span>(self, images, lidar<span style="color:#f92672">=</span><span style="color:#66d9ef">None</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># æå–BEVç‰¹å¾</span>
</span></span><span style="display:flex;"><span>        bev_features <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>backbone(images)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å¤šä»»åŠ¡å¹¶è¡Œé¢„æµ‹</span>
</span></span><span style="display:flex;"><span>        outputs <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;detection&#39;</span>: self<span style="color:#f92672">.</span>perception_head(bev_features),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;map&#39;</span>: self<span style="color:#f92672">.</span>map_head(bev_features),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;occupancy&#39;</span>: self<span style="color:#f92672">.</span>occ_head(bev_features),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;motion&#39;</span>: self<span style="color:#f92672">.</span>motion_head(bev_features),
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;planning&#39;</span>: self<span style="color:#f92672">.</span>planning_head(bev_features)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> outputs
</span></span></code></pre></div><hr>
<h2 id="-æ ¸å¿ƒç»„ä»¶è¯¦è§£">ðŸ§© <strong>æ ¸å¿ƒç»„ä»¶è¯¦è§£</strong></h2>
<h3 id="1-æ„ŸçŸ¥æ¨¡å—perception">1. <strong>æ„ŸçŸ¥æ¨¡å—ï¼ˆPerceptionï¼‰</strong></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PerceptionHead</span>(nn<span style="color:#f92672">.</span>Module):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;æ£€æµ‹+è·Ÿè¸ªï¼ŒåŸºäºŽQuery-basedè®¾è®¡&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, num_queries<span style="color:#f92672">=</span><span style="color:#ae81ff">100</span>):
</span></span><span style="display:flex;"><span>        super()<span style="color:#f92672">.</span><span style="color:#a6e22e">__init__</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Queryåˆå§‹åŒ–</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>query_embed <span style="color:#f92672">=</span> nn<span style="color:#f92672">.</span>Embedding(num_queries, hidden_dim)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Transformerè§£ç å™¨</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>decoder <span style="color:#f92672">=</span> TransformerDecoder(
</span></span><span style="display:flex;"><span>            num_layers<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>,
</span></span><span style="display:flex;"><span>            num_heads<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>,
</span></span><span style="display:flex;"><span>            dim_feedforward<span style="color:#f92672">=</span><span style="color:#ae81ff">2048</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">forward</span>(self, bev_features, queries):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ç”¨Queryä¸ŽBEVç‰¹å¾äº¤äº’</span>
</span></span><span style="display:flex;"><span>        outputs <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>decoder(queries, bev_features)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># é¢„æµ‹3Dæ¡†ã€é€Ÿåº¦ã€ç±»åˆ«ç­‰</span>
</span></span><span style="display:flex;"><span>        bboxes <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>bbox_head(outputs)
</span></span><span style="display:flex;"><span>        scores <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>score_head(outputs)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;boxes&#39;</span>: bboxes, <span style="color:#e6db74">&#39;scores&#39;</span>: scores}
</span></span></code></pre></div><h3 id="2-é¢„æµ‹æ¨¡å—prediction">2. <strong>é¢„æµ‹æ¨¡å—ï¼ˆPredictionï¼‰</strong></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MotionHead</span>(nn<span style="color:#f92672">.</span>Module):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;è½¨è¿¹é¢„æµ‹ï¼Œè€ƒè™‘å¤šæ™ºèƒ½ä½“äº¤äº’&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        super()<span style="color:#f92672">.</span><span style="color:#a6e22e">__init__</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># åœºæ™¯çº§äº¤äº’å»ºæ¨¡</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>scene_encoder <span style="color:#f92672">=</span> SceneEncoder()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># å¤šæ¨¡æ€è½¨è¿¹ç”Ÿæˆ</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>trajectory_decoder <span style="color:#f92672">=</span> TrajectoryDecoder(
</span></span><span style="display:flex;"><span>            num_modes<span style="color:#f92672">=</span><span style="color:#ae81ff">6</span>,          <span style="color:#75715e"># 6æ¡å¯èƒ½è½¨è¿¹</span>
</span></span><span style="display:flex;"><span>            horizon<span style="color:#f92672">=</span><span style="color:#ae81ff">12</span>            <span style="color:#75715e"># é¢„æµ‹æœªæ¥3ç§’ï¼ˆ12å¸§@4Hzï¼‰</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">forward</span>(self, bev_features, agent_queries):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ç¼–ç åœºæ™¯ä¸Šä¸‹æ–‡</span>
</span></span><span style="display:flex;"><span>        scene_context <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>scene_encoder(bev_features)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ä¸ºæ¯ä¸ªæ™ºèƒ½ä½“é¢„æµ‹å¤šæ¨¡æ€è½¨è¿¹</span>
</span></span><span style="display:flex;"><span>        trajectories <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        confidences <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> agent_query <span style="color:#f92672">in</span> agent_queries:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># è€ƒè™‘ä¸Žåœºæ™¯å’Œå…¶ä»–æ™ºèƒ½ä½“çš„äº¤äº’</span>
</span></span><span style="display:flex;"><span>            traj, conf <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>trajectory_decoder(
</span></span><span style="display:flex;"><span>                agent_query, scene_context
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>            trajectories<span style="color:#f92672">.</span>append(traj)
</span></span><span style="display:flex;"><span>            confidences<span style="color:#f92672">.</span>append(conf)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;trajectories&#39;</span>: trajectories,  <span style="color:#75715e"># [B, N, M, T, 2]</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;confidences&#39;</span>: confidences     <span style="color:#75715e"># [B, N, M]</span>
</span></span><span style="display:flex;"><span>        }
</span></span></code></pre></div><h3 id="3-è§„åˆ’æ¨¡å—planning">3. <strong>è§„åˆ’æ¨¡å—ï¼ˆPlanningï¼‰</strong></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PlanningHead</span>(nn<span style="color:#f92672">.</span>Module):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;ç«¯åˆ°ç«¯è·¯å¾„è§„åˆ’&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self, planning_horizon<span style="color:#f92672">=</span><span style="color:#ae81ff">80</span>):
</span></span><span style="display:flex;"><span>        super()<span style="color:#f92672">.</span><span style="color:#a6e22e">__init__</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è‡ªè½¦çŠ¶æ€ç¼–ç </span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>ego_encoder <span style="color:#f92672">=</span> EgoStateEncoder()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># åŸºäºŽtransformerçš„è§„åˆ’å™¨</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>planner <span style="color:#f92672">=</span> TransformerPlanner(
</span></span><span style="display:flex;"><span>            hidden_dim<span style="color:#f92672">=</span><span style="color:#ae81ff">256</span>,
</span></span><span style="display:flex;"><span>            num_layers<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>,
</span></span><span style="display:flex;"><span>            num_heads<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è½¨è¿¹è§£ç å™¨</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>trajectory_decoder <span style="color:#f92672">=</span> MLP(
</span></span><span style="display:flex;"><span>            input_dim<span style="color:#f92672">=</span><span style="color:#ae81ff">256</span>,
</span></span><span style="display:flex;"><span>            hidden_dims<span style="color:#f92672">=</span>[<span style="color:#ae81ff">512</span>, <span style="color:#ae81ff">256</span>, <span style="color:#ae81ff">128</span>],
</span></span><span style="display:flex;"><span>            output_dim<span style="color:#f92672">=</span>planning_horizon <span style="color:#f92672">*</span> <span style="color:#ae81ff">2</span>  <span style="color:#75715e"># (x, y)åæ ‡</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">forward</span>(self, bev_features, ego_state, goals):
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        ego_state: è‡ªè½¦çŠ¶æ€ [é€Ÿåº¦ã€èˆªå‘è§’ç­‰]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        goals: å¯èƒ½çš„ç»ˆç‚¹ [å¯é€‰]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ç¼–ç è‡ªè½¦çŠ¶æ€</span>
</span></span><span style="display:flex;"><span>        ego_embedding <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>ego_encoder(ego_state)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ä¸Žåœºæ™¯ç‰¹å¾èžåˆ</span>
</span></span><span style="display:flex;"><span>        planning_features <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>cat([
</span></span><span style="display:flex;"><span>            bev_features<span style="color:#f92672">.</span>mean(dim<span style="color:#f92672">=</span>[<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>]),  <span style="color:#75715e"># å…¨å±€åœºæ™¯ç‰¹å¾</span>
</span></span><span style="display:flex;"><span>            ego_embedding
</span></span><span style="display:flex;"><span>        ], dim<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è§„åˆ’æŽ¨ç†</span>
</span></span><span style="display:flex;"><span>        plan_latent <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>planner(planning_features)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è§£ç ä¸ºè½¨è¿¹</span>
</span></span><span style="display:flex;"><span>        trajectory <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>trajectory_decoder(plan_latent)
</span></span><span style="display:flex;"><span>        trajectory <span style="color:#f92672">=</span> trajectory<span style="color:#f92672">.</span>view(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, self<span style="color:#f92672">.</span>planning_horizon, <span style="color:#ae81ff">2</span>)  <span style="color:#75715e"># [B, T, 2]</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;trajectory&#39;</span>: trajectory,
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;cost_map&#39;</span>: <span style="color:#66d9ef">None</span>,  <span style="color:#75715e"># ç«¯åˆ°ç«¯ä¸æ˜¾å¼ç”Ÿæˆä»£ä»·åœ°å›¾</span>
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;feasibility&#39;</span>: self<span style="color:#f92672">.</span>feasibility_head(plan_latent)
</span></span><span style="display:flex;"><span>        }
</span></span></code></pre></div><hr>
<h2 id="-è®­ç»ƒç­–ç•¥çš„åˆ›æ–°">ðŸ”„ <strong>è®­ç»ƒç­–ç•¥çš„åˆ›æ–°</strong></h2>
<h3 id="å¤šä»»åŠ¡è”åˆè®­ç»ƒ">å¤šä»»åŠ¡è”åˆè®­ç»ƒ</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">multi_task_loss</span>(predictions, ground_truth):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;ç»Ÿä¸€çš„å¤šä»»åŠ¡æŸå¤±å‡½æ•°&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    losses <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 1. æ£€æµ‹æŸå¤±</span>
</span></span><span style="display:flex;"><span>    losses[<span style="color:#e6db74">&#39;det&#39;</span>] <span style="color:#f92672">=</span> detection_loss(
</span></span><span style="display:flex;"><span>        predictions[<span style="color:#e6db74">&#39;detection&#39;</span>], 
</span></span><span style="display:flex;"><span>        ground_truth[<span style="color:#e6db74">&#39;boxes&#39;</span>]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 2. è·Ÿè¸ªæŸå¤±</span>
</span></span><span style="display:flex;"><span>    losses[<span style="color:#e6db74">&#39;track&#39;</span>] <span style="color:#f92672">=</span> tracking_loss(
</span></span><span style="display:flex;"><span>        predictions[<span style="color:#e6db74">&#39;detection&#39;</span>], 
</span></span><span style="display:flex;"><span>        ground_truth[<span style="color:#e6db74">&#39;track_ids&#39;</span>]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 3. åœ°å›¾ç†è§£æŸå¤±</span>
</span></span><span style="display:flex;"><span>    losses[<span style="color:#e6db74">&#39;map&#39;</span>] <span style="color:#f92672">=</span> map_loss(
</span></span><span style="display:flex;"><span>        predictions[<span style="color:#e6db74">&#39;map&#39;</span>], 
</span></span><span style="display:flex;"><span>        ground_truth[<span style="color:#e6db74">&#39;hdmap&#39;</span>]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 4. å æ®é¢„æµ‹æŸå¤±</span>
</span></span><span style="display:flex;"><span>    losses[<span style="color:#e6db74">&#39;occ&#39;</span>] <span style="color:#f92672">=</span> occupancy_loss(
</span></span><span style="display:flex;"><span>        predictions[<span style="color:#e6db74">&#39;occupancy&#39;</span>], 
</span></span><span style="display:flex;"><span>        ground_truth[<span style="color:#e6db74">&#39;occupancy&#39;</span>]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 5. è¿åŠ¨é¢„æµ‹æŸå¤±</span>
</span></span><span style="display:flex;"><span>    losses[<span style="color:#e6db74">&#39;motion&#39;</span>] <span style="color:#f92672">=</span> motion_loss(
</span></span><span style="display:flex;"><span>        predictions[<span style="color:#e6db74">&#39;motion&#39;</span>], 
</span></span><span style="display:flex;"><span>        ground_truth[<span style="color:#e6db74">&#39;trajectories&#39;</span>]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># 6. è§„åˆ’æŸå¤±ï¼ˆå…³é”®ï¼ï¼‰</span>
</span></span><span style="display:flex;"><span>    losses[<span style="color:#e6db74">&#39;plan&#39;</span>] <span style="color:#f92672">=</span> planning_loss(
</span></span><span style="display:flex;"><span>        predictions[<span style="color:#e6db74">&#39;planning&#39;</span>], 
</span></span><span style="display:flex;"><span>        ground_truth[<span style="color:#e6db74">&#39;ego_trajectory&#39;</span>]
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># åŠ æƒæ±‚å’Œ</span>
</span></span><span style="display:flex;"><span>    total_loss <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>        losses[<span style="color:#e6db74">&#39;det&#39;</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>        losses[<span style="color:#e6db74">&#39;track&#39;</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>        losses[<span style="color:#e6db74">&#39;map&#39;</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.5</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>        losses[<span style="color:#e6db74">&#39;occ&#39;</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">0.5</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>        losses[<span style="color:#e6db74">&#39;motion&#39;</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">2.0</span> <span style="color:#f92672">+</span>
</span></span><span style="display:flex;"><span>        losses[<span style="color:#e6db74">&#39;plan&#39;</span>] <span style="color:#f92672">*</span> <span style="color:#ae81ff">5.0</span>  <span style="color:#75715e"># è§„åˆ’ä»»åŠ¡æƒé‡æœ€é«˜</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> total_loss, losses
</span></span></code></pre></div><h3 id="è¯¾ç¨‹å­¦ä¹ ç­–ç•¥">è¯¾ç¨‹å­¦ä¹ ç­–ç•¥</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CurriculumLearning</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;æ¸è¿›å¼è®­ç»ƒç­–ç•¥&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">schedule_training</span>(self, epoch):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> epoch <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">10</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># é˜¶æ®µ1ï¼šåªè®­ç»ƒæ„ŸçŸ¥</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;det&#39;</span>: <span style="color:#ae81ff">1.0</span>, <span style="color:#e6db74">&#39;track&#39;</span>: <span style="color:#ae81ff">1.0</span>, <span style="color:#e6db74">&#39;map&#39;</span>: <span style="color:#ae81ff">0.5</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> epoch <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">20</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># é˜¶æ®µ2ï¼šåŠ å…¥é¢„æµ‹</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;det&#39;</span>: <span style="color:#ae81ff">1.0</span>, <span style="color:#e6db74">&#39;track&#39;</span>: <span style="color:#ae81ff">1.0</span>, <span style="color:#e6db74">&#39;map&#39;</span>: <span style="color:#ae81ff">0.5</span>, 
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;motion&#39;</span>: <span style="color:#ae81ff">1.0</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">elif</span> epoch <span style="color:#f92672">&lt;</span> <span style="color:#ae81ff">30</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># é˜¶æ®µ3ï¼šåŠ å…¥è§„åˆ’</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;det&#39;</span>: <span style="color:#ae81ff">1.0</span>, <span style="color:#e6db74">&#39;track&#39;</span>: <span style="color:#ae81ff">1.0</span>, <span style="color:#e6db74">&#39;map&#39;</span>: <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;motion&#39;</span>: <span style="color:#ae81ff">2.0</span>, <span style="color:#e6db74">&#39;plan&#39;</span>: <span style="color:#ae81ff">5.0</span>}
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># é˜¶æ®µ4ï¼šå…¨ä»»åŠ¡è”åˆè®­ç»ƒ</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">return</span> {<span style="color:#e6db74">&#39;det&#39;</span>: <span style="color:#ae81ff">1.0</span>, <span style="color:#e6db74">&#39;track&#39;</span>: <span style="color:#ae81ff">1.0</span>, <span style="color:#e6db74">&#39;map&#39;</span>: <span style="color:#ae81ff">0.5</span>,
</span></span><span style="display:flex;"><span>                    <span style="color:#e6db74">&#39;occ&#39;</span>: <span style="color:#ae81ff">0.5</span>, <span style="color:#e6db74">&#39;motion&#39;</span>: <span style="color:#ae81ff">2.0</span>, <span style="color:#e6db74">&#39;plan&#39;</span>: <span style="color:#ae81ff">5.0</span>}
</span></span></code></pre></div><hr>
<h2 id="-æ€§èƒ½è¡¨çŽ°">ðŸ“Š <strong>æ€§èƒ½è¡¨çŽ°</strong></h2>
<h3 id="åœ¨nuscenesæ•°æ®é›†ä¸Šçš„ç»“æžœ">åœ¨nuScenesæ•°æ®é›†ä¸Šçš„ç»“æžœ</h3>
<pre tabindex="0"><code>ä»»åŠ¡           | æŒ‡æ ‡          | UniAD  | ä¼ ç»ŸSOTA | æå‡
---------------|---------------|--------|----------|------
3Dæ£€æµ‹         | mAP           | 62.4   | 61.3     | +1.1
è·Ÿè¸ª           | AMOTA         | 69.2   | 68.1     | +1.1
è½¨è¿¹é¢„æµ‹       | minADEâ‚†       | 0.71   | 0.80     | -11.2%
å æ®é¢„æµ‹       | IoU           | 52.3   | 50.1     | +2.2
è§„åˆ’           | L2è¯¯å·®(m)     | 0.78   | 0.89     | -12.4%
ç¢°æ’žçŽ‡         | â†“             | 0.15%  | 0.23%    | -34.8%
</code></pre><h3 id="å…³é”®ä¼˜åŠ¿">å…³é”®ä¼˜åŠ¿</h3>
<ol>
<li><strong>è¯¯å·®å‡å°‘34%</strong>ï¼šç›¸æ¯”æ¨¡å—åŒ–æ–¹æ¡ˆ</li>
<li><strong>å®žæ—¶æŽ¨ç†</strong>ï¼š120ms/å¸§ï¼ˆRTX 3090ï¼‰</li>
<li><strong>æ³›åŒ–æ€§å¼º</strong>ï¼šåœ¨æœªè§è¿‡çš„åœºæ™¯è¡¨çŽ°è‰¯å¥½</li>
</ol>
<hr>
<h2 id="-å¿«é€Ÿå¼€å§‹10åˆ†é’Ÿè·‘é€šdemo">ðŸ› ï¸ <strong>å¿«é€Ÿå¼€å§‹ï¼ˆ10åˆ†é’Ÿè·‘é€šDemoï¼‰</strong></h2>
<h3 id="1-çŽ¯å¢ƒå®‰è£…">1. çŽ¯å¢ƒå®‰è£…</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># å…‹éš†ä»£ç </span>
</span></span><span style="display:flex;"><span>git clone https://github.com/OpenDriveLab/UniAD.git
</span></span><span style="display:flex;"><span>cd UniAD
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ›å»ºçŽ¯å¢ƒ</span>
</span></span><span style="display:flex;"><span>conda create -n uniad python<span style="color:#f92672">=</span>3.8
</span></span><span style="display:flex;"><span>conda activate uniad
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…ä¾èµ–</span>
</span></span><span style="display:flex;"><span>pip install torch<span style="color:#f92672">==</span>1.11.0+cu113 torchvision<span style="color:#f92672">==</span>0.12.0+cu113 <span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span>            torchaudio<span style="color:#f92672">==</span>0.11.0 --extra-index-url https://download.pytorch.org/whl/cu113
</span></span><span style="display:flex;"><span>pip install mmcv-full<span style="color:#f92672">==</span>1.6.0 -f https://download.openmmlab.com/mmcv/dist/cu113/torch1.11.0/index.html
</span></span><span style="display:flex;"><span>pip install -r requirements.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…MMDetection3D</span>
</span></span><span style="display:flex;"><span>pip install mmdet<span style="color:#f92672">==</span>2.28.2
</span></span><span style="display:flex;"><span>pip install mmdet3d<span style="color:#f92672">==</span>1.1.0
</span></span></code></pre></div><h3 id="2-ä¸‹è½½é¢„è®­ç»ƒæ¨¡åž‹">2. ä¸‹è½½é¢„è®­ç»ƒæ¨¡åž‹</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># ä¸‹è½½æ¨¡åž‹æƒé‡</span>
</span></span><span style="display:flex;"><span>mkdir checkpoints
</span></span><span style="display:flex;"><span>wget https://github.com/OpenDriveLab/UniAD/releases/download/v1.0.0/uniad_base.pth -P checkpoints/
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¸‹è½½é…ç½®æ–‡ä»¶</span>
</span></span><span style="display:flex;"><span>wget https://github.com/OpenDriveLab/UniAD/raw/main/configs/uniad_base.py
</span></span></code></pre></div><h3 id="3-è¿è¡ŒæŽ¨ç†demo">3. è¿è¡ŒæŽ¨ç†Demo</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># demo_inference.py</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> torch
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> mmdet3d.apis <span style="color:#f92672">import</span> inference_detector, init_model
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆå§‹åŒ–æ¨¡åž‹</span>
</span></span><span style="display:flex;"><span>config <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;configs/uniad_base.py&#39;</span>
</span></span><span style="display:flex;"><span>checkpoint <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;checkpoints/uniad_base.pth&#39;</span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> init_model(config, checkpoint, device<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;cuda:0&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åŠ è½½ç¤ºä¾‹æ•°æ®</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> dict(
</span></span><span style="display:flex;"><span>    img_filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;demo/data/nuscenes/samples/CAM_FRONT/n015-2018-08-02-17-16-37+0800__CAM_FRONT__1533201471912460.jpg&#39;</span>,
</span></span><span style="display:flex;"><span>    lidar_filename<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;demo/data/nuscenes/samples/LIDAR_TOP/n015-2018-08-02-17-16-37+0800__LIDAR_TOP__1533201471912436.pcd.bin&#39;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŽ¨ç†</span>
</span></span><span style="display:flex;"><span>result <span style="color:#f92672">=</span> inference_detector(model, data)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å¯è§†åŒ–ç»“æžœ</span>
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>show_result(data, result, out_dir<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;demo/vis_results&#39;</span>)
</span></span></code></pre></div><h3 id="4-æŸ¥çœ‹è¾“å‡º">4. æŸ¥çœ‹è¾“å‡º</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;=== UniAD å¤šä»»åŠ¡è¾“å‡º ===&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. æ£€æµ‹ç»“æžœ</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;æ£€æµ‹åˆ° </span><span style="color:#e6db74">{</span>len(result[<span style="color:#e6db74">&#39;detection&#39;</span>])<span style="color:#e6db74">}</span><span style="color:#e6db74"> ä¸ªç‰©ä½“&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, det <span style="color:#f92672">in</span> enumerate(result[<span style="color:#e6db74">&#39;detection&#39;</span>][:<span style="color:#ae81ff">3</span>]):  <span style="color:#75715e"># å‰3ä¸ª</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  ç‰©ä½“</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">: ä½ç½®</span><span style="color:#e6db74">{</span>det[<span style="color:#e6db74">&#39;bbox_3d&#39;</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">, åˆ†æ•°</span><span style="color:#e6db74">{</span>det[<span style="color:#e6db74">&#39;score&#39;</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. è½¨è¿¹é¢„æµ‹</span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">è½¨è¿¹é¢„æµ‹:&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, traj <span style="color:#f92672">in</span> enumerate(result[<span style="color:#e6db74">&#39;motion&#39;</span>][<span style="color:#e6db74">&#39;trajectories&#39;</span>][:<span style="color:#ae81ff">2</span>]):  <span style="color:#75715e"># å‰2ä¸ªæ™ºèƒ½ä½“</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  æ™ºèƒ½ä½“</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">: </span><span style="color:#e6db74">{</span>len(traj)<span style="color:#e6db74">}</span><span style="color:#e6db74"> æ¡è½¨è¿¹, æœ€å¯èƒ½è½¨è¿¹ç½®ä¿¡åº¦</span><span style="color:#e6db74">{</span>result[<span style="color:#e6db74">&#39;motion&#39;</span>][<span style="color:#e6db74">&#39;confidences&#39;</span>][i]<span style="color:#f92672">.</span>max()<span style="color:#e6db74">:</span><span style="color:#e6db74">.3f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. è§„åˆ’ç»“æžœ</span>
</span></span><span style="display:flex;"><span>plan_traj <span style="color:#f92672">=</span> result[<span style="color:#e6db74">&#39;planning&#39;</span>][<span style="color:#e6db74">&#39;trajectory&#39;</span>]
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">è‡ªè½¦è§„åˆ’è½¨è¿¹: </span><span style="color:#e6db74">{</span>plan_traj<span style="color:#f92672">.</span>shape<span style="color:#e6db74">}</span><span style="color:#e6db74"> (æ—¶é—´æ­¥Ã—2)&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  èµ·ç‚¹: (</span><span style="color:#e6db74">{</span>plan_traj[<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>plan_traj[<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;  ç»ˆç‚¹: (</span><span style="color:#e6db74">{</span>plan_traj[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>plan_traj[<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>]<span style="color:#e6db74">:</span><span style="color:#e6db74">.1f</span><span style="color:#e6db74">}</span><span style="color:#e6db74">)&#34;</span>)
</span></span></code></pre></div><hr>
<h2 id="-æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹">ðŸ’¡ <strong>æ ¸å¿ƒæŠ€æœ¯è¦ç‚¹</strong></h2>
<h3 id="1-query-basedç»Ÿä¸€è¡¨ç¤º">1. <strong>Query-basedç»Ÿä¸€è¡¨ç¤º</strong></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># æ‰€æœ‰ä»»åŠ¡å…±äº«Query</span>
</span></span><span style="display:flex;"><span>queries <span style="color:#f92672">=</span> QueryEmbedding(num_tasks<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)  <span style="color:#75715e"># æ£€æµ‹ã€è·Ÿè¸ªã€åœ°å›¾ã€é¢„æµ‹ã€è§„åˆ’</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Queryé—´çš„ä¿¡æ¯æµ</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> task <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;det&#39;</span>, <span style="color:#e6db74">&#39;track&#39;</span>, <span style="color:#e6db74">&#39;map&#39;</span>, <span style="color:#e6db74">&#39;motion&#39;</span>, <span style="color:#e6db74">&#39;plan&#39;</span>]:
</span></span><span style="display:flex;"><span>    task_queries <span style="color:#f92672">=</span> queries<span style="color:#f92672">.</span>get_task_queries(task)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># è·¨ä»»åŠ¡æ³¨æ„åŠ›</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> other_task <span style="color:#f92672">in</span> [<span style="color:#e6db74">&#39;det&#39;</span>, <span style="color:#e6db74">&#39;track&#39;</span>, <span style="color:#e6db74">&#39;map&#39;</span>, <span style="color:#e6db74">&#39;motion&#39;</span>, <span style="color:#e6db74">&#39;plan&#39;</span>]:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> other_task <span style="color:#f92672">!=</span> task:
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># ä»Žå…¶ä»–ä»»åŠ¡èŽ·å–ä¿¡æ¯</span>
</span></span><span style="display:flex;"><span>            other_features <span style="color:#f92672">=</span> queries<span style="color:#f92672">.</span>get_task_features(other_task)
</span></span><span style="display:flex;"><span>            task_queries <span style="color:#f92672">=</span> cross_attention(task_queries, other_features)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># æ›´æ–°æœ¬ä»»åŠ¡è¾“å‡º</span>
</span></span><span style="display:flex;"><span>    outputstask_queries
</span></span></code></pre></div><h3 id="2-ä»»åŠ¡é—´æ³¨æ„åŠ›æœºåˆ¶">2. <strong>ä»»åŠ¡é—´æ³¨æ„åŠ›æœºåˆ¶</strong></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">CrossTaskAttention</span>(nn<span style="color:#f92672">.</span>Module):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;è®©ä¸åŒä»»åŠ¡é—´ç›¸äº’é€šä¿¡&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">forward</span>(self, query_features, key_features):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è®¡ç®—è·¨ä»»åŠ¡æ³¨æ„åŠ›</span>
</span></span><span style="display:flex;"><span>        attention_weights <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>matmul(
</span></span><span style="display:flex;"><span>            query_features, key_features<span style="color:#f92672">.</span>transpose(<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        ) <span style="color:#f92672">/</span> math<span style="color:#f92672">.</span>sqrt(self<span style="color:#f92672">.</span>dim)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># è½¯æ³¨æ„åŠ›</span>
</span></span><span style="display:flex;"><span>        attention <span style="color:#f92672">=</span> F<span style="color:#f92672">.</span>softmax(attention_weights, dim<span style="color:#f92672">=-</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ä¿¡æ¯èžåˆ</span>
</span></span><span style="display:flex;"><span>        fused_features <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>matmul(attention, key_features)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> fused_features
</span></span></code></pre></div><hr>
<h2 id="-ä¸Žä¼ ç»Ÿæ–¹æ¡ˆå¯¹æ¯”">ðŸ†š <strong>ä¸Žä¼ ç»Ÿæ–¹æ¡ˆå¯¹æ¯”</strong></h2>
<h3 id="ä¼ ç»Ÿæ–¹æ¡ˆæ¨¡å—åŒ–">ä¼ ç»Ÿæ–¹æ¡ˆï¼ˆæ¨¡å—åŒ–ï¼‰</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># å„ä¸ªæ¨¡å—ç‹¬ç«‹</span>
</span></span><span style="display:flex;"><span>perception_output <span style="color:#f92672">=</span> perception_model(sensor_data)  <span style="color:#75715e"># æ£€æµ‹è·Ÿè¸ª</span>
</span></span><span style="display:flex;"><span>prediction_output <span style="color:#f92672">=</span> prediction_model(perception_output)  <span style="color:#75715e"># è½¨è¿¹é¢„æµ‹</span>
</span></span><span style="display:flex;"><span>planning_output <span style="color:#f92672">=</span> planning_model(perception_output, prediction_output)  <span style="color:#75715e"># è§„åˆ’</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># é—®é¢˜ï¼šè¯¯å·®ä¼ æ’­ã€ä¿¡æ¯æŸå¤±ã€å»¶è¿Ÿç´¯ç§¯</span>
</span></span></code></pre></div><h3 id="uniadç«¯åˆ°ç«¯">UniADï¼ˆç«¯åˆ°ç«¯ï¼‰</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># ç»Ÿä¸€æ¨¡åž‹</span>
</span></span><span style="display:flex;"><span>all_outputs <span style="color:#f92672">=</span> uniad_model(sensor_data)  <span style="color:#75715e"># åŒæ—¶è¾“å‡ºæ‰€æœ‰ç»“æžœ</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¼˜åŠ¿ï¼š</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 1. å…±äº«ç‰¹å¾ï¼Œå‡å°‘é‡å¤è®¡ç®—</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 2. è”åˆä¼˜åŒ–ï¼Œé¿å…è¯¯å·®ç´¯ç§¯</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 3. ç«¯åˆ°ç«¯è®­ç»ƒï¼Œç›´æŽ¥ä¼˜åŒ–æœ€ç»ˆç›®æ ‡</span>
</span></span></code></pre></div><hr>
<h2 id="-å®žé™…éƒ¨ç½²è€ƒè™‘">ðŸ“ˆ <strong>å®žé™…éƒ¨ç½²è€ƒè™‘</strong></h2>
<h3 id="è®¡ç®—ä¼˜åŒ–">è®¡ç®—ä¼˜åŒ–</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UniADLite</span>(nn<span style="color:#f92672">.</span>Module):
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#34;&#34;&#34;è½»é‡ç‰ˆUniADï¼Œé€‚åˆéƒ¨ç½²&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">__init__</span>(self):
</span></span><span style="display:flex;"><span>        super()<span style="color:#f92672">.</span><span style="color:#a6e22e">__init__</span>()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 1. è½»é‡éª¨å¹²ç½‘ç»œ</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>backbone <span style="color:#f92672">=</span> EfficientNetBEV()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 2. çŸ¥è¯†è’¸é¦</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>distill_from_teacher()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 3. é‡åŒ–æ„ŸçŸ¥è®­ç»ƒ</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>quantize <span style="color:#f92672">=</span> QuantizeWrapper()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># 4. ä»»åŠ¡å‰ªæžï¼ˆæ ¹æ®éœ€æ±‚é€‰æ‹©ä»»åŠ¡ï¼‰</span>
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>enabled_tasks <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;detection&#39;</span>, <span style="color:#e6db74">&#39;planning&#39;</span>]  <span style="color:#75715e"># åªè¿è¡Œå¿…è¦ä»»åŠ¡</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">forward</span>(self, x):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># åŠ¨æ€ä»»åŠ¡é€‰æ‹©</span>
</span></span><span style="display:flex;"><span>        outputs <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;detection&#39;</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>enabled_tasks:
</span></span><span style="display:flex;"><span>            outputs[<span style="color:#e6db74">&#39;detection&#39;</span>] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>det_head(x)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#39;planning&#39;</span> <span style="color:#f92672">in</span> self<span style="color:#f92672">.</span>enabled_tasks:
</span></span><span style="display:flex;"><span>            outputs[<span style="color:#e6db74">&#39;planning&#39;</span>] <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>plan_head(x)
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># ... å…¶ä»–ä»»åŠ¡</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> outputs
</span></span></code></pre></div><hr>
<h2 id="-ä»Šæ—¥å­¦ä¹ ä»»åŠ¡">ðŸŽ¯ <strong>ä»Šæ—¥å­¦ä¹ ä»»åŠ¡</strong></h2>
<h3 id="åŸºç¡€ä»»åŠ¡30åˆ†é’Ÿ">åŸºç¡€ä»»åŠ¡ï¼ˆ30åˆ†é’Ÿï¼‰ï¼š</h3>
<ol>
<li>
<p><strong>é˜…è¯»è®ºæ–‡æ‘˜è¦</strong>ï¼ˆ5åˆ†é’Ÿï¼‰</p>
<ul>
<li>ç†è§£æ ¸å¿ƒåˆ›æ–°ç‚¹</li>
<li>æŸ¥çœ‹å…³é”®å›¾è¡¨</li>
</ul>
</li>
<li>
<p><strong>è¿è¡Œå®˜æ–¹Demo</strong>ï¼ˆ15åˆ†é’Ÿï¼‰</p>
<ul>
<li>æŒ‰ç…§ä¸Šé¢&quot;å¿«é€Ÿå¼€å§‹&quot;æ­¥éª¤è·‘é€šæŽ¨ç†</li>
<li>è§‚å¯Ÿè¾“å‡ºç»“æžœ</li>
</ul>
</li>
<li>
<p><strong>æŸ¥çœ‹æ¨¡åž‹ç»“æž„</strong>ï¼ˆ10åˆ†é’Ÿï¼‰</p>
<ul>
<li>æµè§ˆ <code>configs/uniad_base.py</code></li>
<li>ç†è§£å„ä¸ªç»„ä»¶è¿žæŽ¥</li>
</ul>
</li>
</ol>
<h3 id="è¿›é˜¶ä»»åŠ¡å¯é€‰">è¿›é˜¶ä»»åŠ¡ï¼ˆå¯é€‰ï¼‰ï¼š</h3>
<ol>
<li>
<p><strong>åˆ†æžæŸå¤±å‡½æ•°</strong>ï¼ˆ20åˆ†é’Ÿï¼‰</p>
<ul>
<li>æŸ¥çœ‹ <code>models/losses.py</code></li>
<li>ç†è§£å¤šä»»åŠ¡æƒé‡è®¾ç½®</li>
</ul>
</li>
<li>
<p><strong>å¯¹æ¯”å®žéªŒ</strong>ï¼ˆ30åˆ†é’Ÿï¼‰</p>
<ul>
<li>åœ¨nuSceneséªŒè¯é›†ä¸Šæµ‹è¯•</li>
<li>å¯¹æ¯”å•ä»»åŠ¡vså¤šä»»åŠ¡æ€§èƒ½</li>
</ul>
</li>
<li>
<p><strong>æ€è€ƒé¢˜</strong>ï¼ˆ15åˆ†é’Ÿï¼‰</p>
<ul>
<li>UniADçš„ç“¶é¢ˆæ˜¯ä»€ä¹ˆï¼Ÿ</li>
<li>å¦‚ä½•è¿›ä¸€æ­¥å‡å°‘å»¶è¿Ÿï¼Ÿ</li>
<li>èƒ½å¦åº”ç”¨åˆ°æœºå™¨äººå¯¼èˆªï¼Ÿ</li>
</ul>
</li>
</ol>
<hr>
<h2 id="-æ‰©å±•é˜…è¯»">ðŸ“š <strong>æ‰©å±•é˜…è¯»</strong></h2>
<h3 id="ç›¸å…³è®ºæ–‡">ç›¸å…³è®ºæ–‡ï¼š</h3>
<ol>
<li><strong>BEVFormer</strong>ï¼ˆæ„ŸçŸ¥åŸºç¡€ï¼‰</li>
<li><strong>Planning-oriented Autonomous Driving</strong>ï¼ˆè§„åˆ’å¯¼å‘ï¼‰</li>
<li><strong>ST-P3</strong>ï¼ˆç«¯åˆ°ç«¯é¢„æµ‹ï¼‰</li>
</ol>
<h3 id="å¼€æºé¡¹ç›®">å¼€æºé¡¹ç›®ï¼š</h3>
<ol>
<li><strong>UniADå®˜æ–¹ä»£ç </strong></li>
<li><strong>BEVDet</strong>ï¼ˆæ„ŸçŸ¥éƒ¨åˆ†å‚è€ƒï¼‰</li>
<li><strong>mmdetection3d</strong>ï¼ˆåŸºç¡€æ¡†æž¶ï¼‰</li>
</ol>
<h3 id="è§†é¢‘è®²è§£">è§†é¢‘è®²è§£ï¼š</h3>
<ol>
<li><strong>Bç«™ï¼šCVPR 2023 UniADè®ºæ–‡è®²è§£</strong></li>
<li><strong>YouTubeï¼šUniADä½œè€…åˆ†äº«</strong></li>
</ol>
<hr>
<h2 id="-æ€»ç»“è¦ç‚¹">ðŸ’Ž <strong>æ€»ç»“è¦ç‚¹</strong></h2>
<h3 id="uniadçš„ä¸‰ä¸ªæ ¸å¿ƒè´¡çŒ®">UniADçš„ä¸‰ä¸ªæ ¸å¿ƒè´¡çŒ®ï¼š</h3>
<ol>
<li><strong>ç»Ÿä¸€æž¶æž„</strong>ï¼šé¦–ä¸ªç«¯åˆ°ç«¯è‡ªåŠ¨é©¾é©¶å…¨æ ˆæ¨¡åž‹</li>
<li><strong>ä»»åŠ¡ååŒ</strong>ï¼šæ„ŸçŸ¥ã€é¢„æµ‹ã€è§„åˆ’è”åˆä¼˜åŒ–</li>
<li><strong>æ€§èƒ½æå‡</strong>ï¼šå…³é”®æŒ‡æ ‡æå‡æ˜¾è‘—</li>
</ol>
<h3 id="å®žé™…ä»·å€¼">å®žé™…ä»·å€¼ï¼š</h3>
<ul>
<li>ðŸš— <strong>å‡å°‘è¯¯å·®ä¼ æ’­</strong>ï¼šç«¯åˆ°ç«¯è®­ç»ƒé¿å…æ¨¡å—é—´è¯¯å·®ç´¯ç§¯</li>
<li>âš¡ <strong>é™ä½Žå»¶è¿Ÿ</strong>ï¼šå…±äº«ç‰¹å¾è®¡ç®—ï¼Œå‡å°‘é‡å¤å¤„ç†</li>
<li>ðŸŽ¯ <strong>ä¼˜åŒ–æœ€ç»ˆç›®æ ‡</strong>ï¼šç›´æŽ¥ä¼˜åŒ–é©¾é©¶æ€§èƒ½ï¼Œè€Œéžä¸­é—´æŒ‡æ ‡</li>
<li>ðŸ”„ <strong>æ›´å¥½çš„æ³›åŒ–</strong>ï¼šå­¦ä¹ åˆ°çš„è¡¨ç¤ºæ›´é€šç”¨</li>
</ul>
<hr>
<p><strong>æ˜Žæ—¥é¢„å‘Š</strong>ï¼šç‰¹æ–¯æ‹‰çš„<strong>Occupancy Network</strong>æ·±åº¦è§£æžï¼Œä»¥åŠå¦‚ä½•ä»ŽBEVå‡çº§åˆ°Occupancyè¡¨ç¤ºã€‚</p>
<p><strong>ä»Šæ—¥æ‰“å¡</strong>ï¼šâœ… å·²å­¦ä¹  UniAD - ç«¯åˆ°ç«¯è‡ªåŠ¨é©¾é©¶ç»Ÿä¸€æ¨¡åž‹</p>
<p>æœ‰ä»€ä¹ˆé—®é¢˜æˆ–è€…æƒ³æ·±å…¥äº†è§£çš„æ–¹é¢å—ï¼Ÿæˆ‘å¯ä»¥æä¾›æ›´è¯¦ç»†çš„ä»£ç è§£æžæˆ–åŽŸç†è¯´æ˜Žï¼</p>
</section>

  <nav
    class="mt-24 flex overflow-hidden rounded-xl bg-black/[3%] text-lg leading-[1.2]! *:flex *:w-1/2 *:items-center *:p-5 *:font-medium *:no-underline dark:bg-white/[8%] [&>*:hover]:bg-black/[2%] dark:[&>*:hover]:bg-white/[3%]"
  ><a class="ltr:pr-3 rtl:pl-3" href="https://loveppdog.github.io/posts/rt-2-20260123/"
      ><span class="ltr:mr-1.5 rtl:ml-1.5">â†</span><span></span></a
    ></nav></article></main><footer
  class="mx-auto flex h-[4.5rem] max-w-(--w) items-center px-8 text-xs tracking-wider uppercase opacity-60"
>
  <div class="mr-auto">&copy;2026
    <a class="link" href="https://loveppdog.github.io/">è‡ªåŠ¨é©¾é©¶/æœºå™¨äººå­¦ä¹ ç¬”è®°</a></div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank"
    >powered by hugoï¸ï¸</a
  >ï¸
  <a
    class="link"
    href="https://github.com/nanxiaobei/hugo-paper"
    rel="noopener"
    target="_blank"
    >hugo-paper</a
  >
</footer>
</body>
</html>
